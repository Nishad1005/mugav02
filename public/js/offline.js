(function(g){var window=this;'use strict';var xhK=function(A){var L=new g.i6("und",new g.$6("Default","und",!0));L.captionTracks=A.captionTracks;return L},e4d=function(A){return new g.QX(function(L,B){var f=A.length,K=[];
if(f)for(var V=function(N,F){f--;K[N]=F;f==0&&L(K)},J=function(N){B(N)},R,Z=0;Z<A.length;Z++)R=A[Z],g.IXS(R,g.Od(V,Z),J);
else L(K)})},C7=function(A){this.N=A},iU=function(){C7.apply(this,arguments)},nEd=function(){iU.apply(this,arguments)},z4d=function(){iU.apply(this,arguments)},ust=function(){iU.apply(this,arguments)},anX=function(){iU.apply(this,arguments)},AW9=function(){iU.apply(this,arguments)},L2w=function(){iU.apply(this,arguments)},osf=function(){iU.apply(this,arguments)},BFf=function(){C7.apply(this,arguments)},fXW=function(){iU.apply(this,arguments)},K25=function(){iU.apply(this,arguments)},VXW=function(){iU.apply(this,
arguments)},JWX=function(){iU.apply(this,arguments)},Sw9=function(){iU.apply(this,arguments)},Rt9=function(){iU.apply(this,arguments)},ZCd=function(){iU.apply(this,arguments)},NF5=function(){iU.apply(this,arguments)},F2w=function(){iU.apply(this,arguments)},Dl5=function(){iU.apply(this,arguments)},dlw=function(){iU.apply(this,arguments)},IXR=function(){iU.apply(this,arguments)},wIR=function(){C7.apply(this,arguments)},pIW=function(){iU.apply(this,arguments)},yWw=function(){iU.apply(this,arguments)},
jFw=function(){iU.apply(this,arguments)},gst=function(){iU.apply(this,arguments)},GrR=function(){iU.apply(this,arguments)},rWt=function(){iU.apply(this,arguments)},sFw=function(){iU.apply(this,arguments)},HCW=function(){iU.apply(this,arguments)},htf=function(){iU.apply(this,arguments)},bCX=function(){C7.apply(this,arguments)},tX5=function(){C7.apply(this,arguments)},krw=function(){C7.apply(this,arguments)},TFI=function(){iU.apply(this,arguments)},lXI=function(){iU.apply(this,arguments)},mlX=function(){iU.apply(this,
arguments)},QFd=function(){iU.apply(this,arguments)},Cpw=function(){iU.apply(this,arguments)},iCI=function(){iU.apply(this,arguments)},$lK=function(){iU.apply(this,arguments)},XIw=function(){iU.apply(this,arguments)},OCw=function(){iU.apply(this,arguments)},Esw=function(){iU.apply(this,arguments)},cWK=function(){iU.apply(this,arguments)},MXt=function(){iU.apply(this,arguments)},YwX=function(){iU.apply(this,arguments)},UlO=function(){iU.apply(this,arguments)},W2d=function(){iU.apply(this,arguments)},
vsK=function(){iU.apply(this,arguments)},qwf=function(){iU.apply(this,arguments)},PpR=function(){iU.apply(this,arguments)},xlw=function(){iU.apply(this,arguments)},etW=function(){iU.apply(this,arguments)},nsK=function(){iU.apply(this,arguments)},ztB=function(){iU.apply(this,arguments)},uI9=function(){iU.apply(this,arguments)},aXO=function(){iU.apply(this,arguments)},AgO=function(){iU.apply(this,arguments)},LlW=function(){iU.apply(this,arguments)},o1K=function(){iU.apply(this,arguments)},BH9=function(){iU.apply(this,
arguments)},fx9=function(){iU.apply(this,arguments)},Klf=function(){C7.apply(this,arguments)},Vqw=function(){iU.apply(this,arguments)},Jgd=function(){iU.apply(this,arguments)},SxX=function(){iU.apply(this,arguments)},Rrf=function(){iU.apply(this,arguments)},Z9t=function(){iU.apply(this,arguments)},NHO=function(){iU.apply(this,arguments)},FlB=function(){iU.apply(this,arguments)},DiB=function(){iU.apply(this,arguments)},di5=function(){iU.apply(this,arguments)},IxW=function(){iU.apply(this,arguments)},
w2W=function(){iU.apply(this,arguments)},p2K=function(){iU.apply(this,arguments)},ygd=function(){iU.apply(this,arguments)},jtX=function(){iU.apply(this,arguments)},g1R=function(){iU.apply(this,arguments)},GHf=function(){iU.apply(this,arguments)},rg5=function(){iU.apply(this,arguments)},stB=function(){iU.apply(this,arguments)},H9O=function(){iU.apply(this,arguments)},hrW=function(){iU.apply(this,arguments)},b9W=function(){iU.apply(this,arguments)},tqf=function(){iU.apply(this,arguments)},kHI=function(){iU.apply(this,
arguments)},THR=function(){iU.apply(this,arguments)},lxK=function(){iU.apply(this,arguments)},miR=function(){iU.apply(this,arguments)},QtK=function(){iU.apply(this,arguments)},CCw=function(){iU.apply(this,arguments)},i9B=function(){iU.apply(this,arguments)},$iB=function(){iU.apply(this,arguments)},X2I=function(){iU.apply(this,arguments)},O9K=function(){iU.apply(this,arguments)},E1K=function(){iU.apply(this,arguments)},cg9=function(){iU.apply(this,arguments)},Mqw=function(A){A=A.key||A.id;
if(!A)throw Error("Entity key is missing");return A},YxI=function(){if($B)return $B();
var A={};$B=g.oI("PersistentEntityStoreDb",{JU:(A.EntityStore={fO:1},A.EntityAssociationStore={fO:2},A),shared:!1,upgrade:function(L,B){B(1)&&g.$L(g.TU(L,"EntityStore",{keyPath:"key"}),"entityType","entityType");B(2)&&(L=g.TU(L,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.$L(L,"byParentEntityKey","parentEntityKey"),g.$L(L,"byChildEntityKey","childEntityKey"))},
version:3});return $B()},Uid=function(A){return g.Wf(YxI(),A)},Wlf=function(A){return g.Wf((0,g.dVt)(),A)},XD=function(A){this.token=A},Oo=function(A,L){L=L===void 0?{}:L;
g.iL.call(this,g.IwB[A],Object.assign({},{name:"PESEncoderError",type:A},L));this.type=A;this.level="WARNING";Object.setPrototypeOf(this,Oo.prototype)},v1t=function(A){return new Oo("WRONG_DATA_TYPE",{jB:A})},qx9=function(A){return A instanceof Error?new Oo("UNKNOWN_ENCODE_ERROR",{originalMessage:A.message}):new Oo("UNKNOWN_ENCODE_ERROR")},PCW=function(A){return A instanceof Error?new Oo("UNKNOWN_DECODE_ERROR",{originalMessage:A.message}):new Oo("UNKNOWN_DECODE_ERROR")},xiw=function(A,L){A=A instanceof
Oo?A:L(A);
g.mL(A);throw A;},erR=function(){},n1w=function(A,L,B){try{return A.V(L,B)}catch(f){xiw(f,qx9)}},zr9=function(A){A=(new TextEncoder).encode(A).subarray(0,16);
var L=new Uint8Array(16);L.set(A);return L},Eo=function(A){this.N=A},axK=function(A){var L=u_f[A];
if(L)return L;g.CE(new g.iL("Entity model not found.",{entityType:A}))},A5B=function(A,L){this.N=A;
this.W=L;this.V={}},oef=function(A,L){a:{A=Ls9(A.W,L.version);
try{var B=A.W(L.data,L.key);break a}catch(f){xiw(f,PCW)}B=void 0}return B},cx=function(A,L,B){return A.N.objectStore("EntityStore").get(L).then(function(f){if(f){if(B&&f.entityType!==B)throw Error("Incorrect entity type");
return oef(A,f)}})},Mk=function(A,L,B){return B?(B=B.map(function(f){return cx(A,f,L)}),g.r2.all(B)):A.N.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(L)).then(function(f){return f.map(function(K){return oef(A,K)})})},Uo=function(A,L,B){var f=Mqw(L),K=Ls9(A.W,1),V=Object.assign({},L);
return A.N.objectStore("EntityStore").get(f).then(function(J){if(J){if(J.entityType!==B)throw Error("Incorrect entity type");V.entityMetadata||(J=oef(A,J),V.entityMetadata=J.entityMetadata)}}).then(function(){var J={key:f,
entityType:B,data:n1w(K,V,f),version:1};return g.r2.all([g.Qw(A.N.objectStore("EntityStore"),J),BV5(A,V,B)])}).then(function(){YB(A,f,B);
return f})},fkd=function(A,L,B){L=L.map(function(f){return Uo(A,f,B)});
return g.r2.all(L)},Wx=function(A,L,B){if(B==null?0:B.u8){var f=new Set;
return KsK(A,L,f).then(function(){for(var V=[],J=g.m(f),R=J.next();!R.done;R=J.next())V.push(Wx(A,R.value));return g.r2.all(V).then(function(){})})}var K=g.Pv(L).entityType;
return g.r2.all([A.N.objectStore("EntityStore").delete(L),VOI(A,L)]).then(function(){YB(A,L,K)})},J5K=function(A,L){return g.cf(A.N.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(L)},function(B){return g.r2.all([B.delete(),
VOI(A,B.cursor.primaryKey)]).then(function(){YB(A,B.cursor.primaryKey,L);return g.O_(B)})})},S3R=function(A,L,B,f){var K=Ls9(A.W,1);
return cx(A,L,f).then(function(V){if(V){V=g.NA(V,B);var J={key:L,entityType:f,data:n1w(K,V,L),version:1};return g.r2.all([g.Qw(A.N.objectStore("EntityStore"),J),BV5(A,V,f)])}}).then(function(){YB(A,L,f);
return L})},YB=function(A,L,B){var f=A.V[B];
f||(f=new Set,A.V[B]=f);f.add(L)},RNK=function(A,L,B){var f=Mqw(L);
B=axK(B);if(!B)return g.r2.resolve([]);B=new B(L);A=A.N.objectStore("EntityAssociationStore");L=[];B=g.m(B.W());for(var K=B.next();!K.done;K=B.next())L.push(g.Qw(A,{parentEntityKey:f,childEntityKey:K.value}));return g.r2.all(L).then(function(V){return V.map(function(J){return J[1]})})},VOI=function(A,L){return A.N.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(L))},BV5=function(A,L,B){var f=Mqw(L);
return VOI(A,f).then(function(){return RNK(A,L,B)})},KsK=function(A,L,B){if(B.has(L))return g.r2.resolve(void 0);
B.add(L);return Ztw(A,L).then(function(f){return A.N.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(L)).then(function(){return f})}).then(function(f){var K=g.r2.resolve(void 0);
f=g.m(f);for(var V=f.next(),J={};!V.done;J={jQ:void 0},V=f.next())J.jQ=V.value,K=K.then(function(R){return function(){return KsK(A,R.jQ,B)}}(J));
return K}).then(function(){})},Ztw=function(A,L){var B=A.N.objectStore("EntityAssociationStore");
return B.index("byParentEntityKey").getAll(IDBKeyRange.only(L)).then(function(f){var K=[];f=g.m(f);for(var V=f.next();!V.done;V=f.next())V=V.value,K.push(B.index("byChildEntityKey").getAll(V.childEntityKey));return g.r2.all(K)}).then(function(f){var K=[];
f=g.m(f);for(var V=f.next();!V.done;V=f.next())V=V.value,V.length===1&&K.push(V[0].childEntityKey);return K})},vx=function(){},NVR=function(){this.N={};
this.N[0]=new vx;if(!g.h_("aes_pes_encoder_killswitch")){var A=this.N;try{var L=g.nn();var B=zr9(L);var f=new Eo(new g.S8(B),new g.Rd(B))}catch(K){throw A=K instanceof Error?new Oo("KEY_CREATION_FAILED",{originalMessage:K.message}):new Oo("KEY_CREATION_FAILED"),g.mL(A),A;}A[1]=f}},Ls9=function(A,L){L=L===void 0?0:L;
A=A.N[L];if(!A)throw L=new Oo("INVALID_ENCODER_VERSION",{jB:L}),g.mL(L),L;return A},qk=function(A,L){g.Y.call(this);
this.token=A;this.N=L;this.observers=[];A=new g.rI.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.nn());A.onmessage=this.W.bind(this);this.channel=A},Px=function(A,L,B){var f,K,V,J;
return g.c(function(R){if(R.N==1)return g.X(R,Uid(A.token),2);if(R.N!=3)return f=R.W,g.X(R,g.mz(f,["EntityStore","EntityAssociationStore"],L,function(Z){K=new A5B(Z,A.N);return B(K)}),3);
V=R.W;K&&(J=K.V,Object.keys(J).length>0&&(A.channel.postMessage(J),Fs9(A,J)));return R.return(V)})},xB=function(A,L,B){return Px(A,{mode:"readwrite",
Ev:!0},function(f){return Uo(f,L,B)})},Dnw=function(A,L){return Px(A,{mode:"readwrite",
Ev:!0},function(B){return fkd(B,L,"offlineOrchestrationActionWrapperEntity")})},dnt=function(A,L){return Px(A,{mode:"readwrite",
Ev:!0},function(B){return Wx(B,L)})},IkW=function(A){return Px(A,{mode:"readwrite",
Ev:!0},function(L){return J5K(L,"videoPlaybackPositionEntity")})},eJ=function(A,L,B){return Px(A,{mode:"readonly",
Ev:!0},function(f){return cx(f,L,B)})},n7=function(A,L,B){return Px(A,{mode:"readonly",
Ev:!0},function(f){return Mk(f,L,B)})},Fs9=function(A,L){A=g.m(A.observers);
for(var B=A.next();!B.done;B=A.next())B=B.value,B(L)},wrt=function(){var A,L,B;
return g.c(function(f){if(f.N==1)return g.S5(f,2),g.X(f,g.Ab(),4);if(f.N!=2){A=f.W;if(!A||!g.zT()||typeof g.rI.BroadcastChannel==="undefined")return f.return();L=new NVR;return f.return(new qk(A,L))}B=g.NX(f);B instanceof Error&&g.mL(B);return f.return()})},zq=function(){pr5||(pr5=wrt());
return pr5},y5f=function(A){var L;
A=(L=A.options)==null?void 0:L.persistenceOption;return A==="ENTITY_PERSISTENCE_OPTION_PERSIST"||A==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},j3I=function(A){var L;
return g.c(function(B){return B.N==1?g.X(B,zq(),2):(L=B.W)?g.X(B,Px(L,"readwrite",function(f){for(var K={},V=g.m(A),J=V.next(),R={};!J.done;R={Jy:void 0,JK:void 0},J=V.next())R.Jy=J.value,R.Jy.entityKey&&y5f(R.Jy)&&(R.JK=g.Hk(R.Jy.payload),J=void 0,R.Jy.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(J=function(Z){return function(){return Uo(f,Z.Jy.payload[Z.JK],Z.JK)}}(R)),R.Jy.type==="ENTITY_MUTATION_TYPE_DELETE"&&(J=function(Z){return function(){return Wx(f,Z.Jy.entityKey)}}(R)),R.Jy.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(J=function(Z){return function(){return S3R(f,Z.Jy.entityKey,Z.Jy.payload[Z.JK],Z.JK)}}(R)),J&&(K[R.Jy.entityKey]=K[R.Jy.entityKey]?K[R.Jy.entityKey].then(J):J()));
return g.r2.all(Object.values(K))}),0):B.return()})},ge9=function(A){var L;
return g.c(function(B){if(B.N==1){L=A.mutations;if(!L||L.length<=0)return B.return();if(g.Iq){var f={type:"ENTITY_LOADED"};L!==void 0&&(f.payload=L);g.Iq.dispatch(f)}return g.X(B,j3I(L),2)}L.length=0;g.VK(B)})},Gz9=function(A){return A!==void 0},r5B=function(A){var L=g.WN();
L=Object.assign({},L);A=Object.assign({},A);for(var B in L)A[B]?(L[B]!==4&&(L[B]=A[B]),delete A[B]):L[B]!==2&&(L[B]=4);Object.assign(L,A);g.ye1(L);JSON.stringify(L);return L},s3f=function(A){var L,B;
return g.c(function(f){if(f.N==1)return g.X(f,g.Ab(),2);if(f.N!=3)return(L=f.W)?g.X(f,g.PN(L),3):f.return();B=f.W;return f.return(g.mz(B,["index","media","captions"],{mode:"readwrite",Ev:!0},function(K){var V=IDBKeyRange.bound(A+"|",A+"~");K=[K.objectStore("index").delete(V),K.objectStore("media").delete(V),K.objectStore("captions").delete(V)];return g.r2.all(K).then(function(){})}))})},Ht5=function(){var A,L;
return g.c(function(B){if(B.N==1)return g.X(B,g.Ab(),2);if(B.N!=3){A=B.W;if(!A)throw g.g2("rvdfd");return g.X(B,g.PN(A),3)}L=B.W;return B.return(g.mz(L,["index","media"],{mode:"readwrite",Ev:!0},function(f){var K={};return g.X4(f.objectStore("index"),{},function(V){var J=V.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),R=g.r2.resolve(void 0);if(J){var Z=J[1];J=J[2];K[Z]=K[Z]||{};var N;K[Z][J]=g.sG1((N=V.getValue())==null?void 0:N.fmts)}else R=V.delete().then(function(){});
return g.r2.all([g.O_(V),R]).then(function(F){return g.m(F).next().value})}).then(function(){for(var V={},J=g.m(Object.keys(K)),R=J.next();!R.done;R=J.next()){R=R.value;
var Z=K[R].v;V[R]=K[R].a&&Z?1:2}var N=r5B(V);return g.ft6(f.objectStore("media"),{},function(F){var D=F.cursor.key.match(g.tLL);D&&V[D[1]]||f.objectStore("media").delete(F.cursor.key);return g.evw(F)}).then(function(){return N})})}))})},hNf=function(A,L){var B,f;
return g.c(function(K){if(K.N==1)return g.X(K,g.Ab(),2);if(K.N!=3){B=K.W;if(!B)throw g.g2("wct");return g.X(K,g.PN(B),3)}f=K.W;return g.X(K,g.mz(f,["captions"],{mode:"readwrite",Ev:!0},function(V){var J=[];V=V.objectStore("captions");for(var R=0;R<L.length;R++){var Z=g.Qw(V,L[R],A+"|"+L[R].metadata.vss_id);J.push(Z)}return g.r2.all(J)}),0)})},btt=function(A){var L,B,f;
return g.c(function(K){if(K.N==1)return L=IDBKeyRange.bound(A+"|",A+"~"),g.X(K,g.Ab(),2);if(K.N!=3){B=K.W;if(!B)throw g.g2("gactfv");return g.X(K,g.PN(B),3)}f=K.W;return K.return(f.getAll("captions",L))})},tOw=function(A){return g.c(function(L){g.qg(A,0);
return L.return(s3f(A))})},kzf=function(A){return{context:g.AV(),
videoIds:A}},TV9=function(A){return{context:g.AV(),
playlistIds:A}},lkW=function(A){return{context:g.AV(),
offlinePlaylistSyncChecks:A}},mn9=function(){this.N=new Map},CH9=function(){Q3R||(Q3R=new mn9);
return Q3R},itB=function(A,L){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:A},metadata:L,statusCode:void 0,csn:void 0,can:void 0}},$nK=function(A,L,B){if(!B){var f=f===void 0?!1:f;
B=A.N.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!B||f)B=g.y0(16),A.N.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",B)}A={flowNonce:B,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:L.eventType};L.metadata&&(A.flowMetadata=L.metadata);L.statusCode!==void 0&&(A.flowEventStatus=L.statusCode);L.csn&&(A.csn=L.csn);L.can&&(A.can=L.can);g.pE("flowEvent",A,void 0)},XrO=function(A){var L,B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw,Xk,e5,mt,T,aO,YW,R0;
return g.c(function(TK){if(TK.N==1)return g.X(TK,Px(A,{mode:"readonly",Ev:!0},function(b){return Mk(b,"playbackData").then(function(Lw){var ro=Lw.map(function(a0){return a0.transfer}).filter(function(a0){return!!a0}),SZ=Lw.map(function(a0){return a0.offlineVideoPolicy}).filter(function(a0){return!!a0}),xg=Lw.filter(function(a0){return!!a0.key}).map(function(a0){return g.xv(g.Pv(a0.key).entityId,"downloadStatusEntity")});
ro=Mk(b,"transfer",ro);SZ=Mk(b,"offlineVideoPolicy",SZ);xg=Mk(b,"downloadStatusEntity",xg);var R8=ro.then(function(a0){a0=a0.reduce(function(oO,tO){(tO==null?0:tO.offlineVideoStreams)&&oO.push.apply(oO,g.x7(tO.offlineVideoStreams));return oO},[]).filter(function(oO){return!!oO});
return Mk(b,"offlineVideoStreams",a0)});
return g.r2.all([ro,SZ,R8,xg]).then(function(a0){var oO=g.m(a0);a0=oO.next().value;var tO=oO.next().value;var k=oO.next().value;oO=oO.next().value;return[Lw,a0,tO,k,oO]})})}),2);
if(TK.N!=3)return L=TK.W,g.X(TK,Px(A,{mode:"readonly",Ev:!0},function(b){return Mk(b,"mainDownloadsListEntity").then(function(Lw){var ro,SZ;return(SZ=(ro=Lw[0])==null?void 0:ro.downloads)!=null?SZ:[]})}),3);
B=TK.W;f=g.m(L);K=f.next().value;V=f.next().value;J=f.next().value;R=f.next().value;Z=f.next().value;N=K;F=V;D=J;I=R;d=Z;w={};r={};h={};Q={};l={};C=[];O=g.m(F);for(v=O.next();!v.done;v=O.next())(U=v.value)&&(w[U.key]=U);a=g.m(D);for(o0=a.next();!o0.done;o0=a.next())(B6=o0.value)&&(r[B6.key]=B6);Ve=g.m(d);for(DS=Ve.next();!DS.done;DS=Ve.next())(fw=DS.value)&&(h[fw.key]=fw);ry=g.m(I);for(uL=ry.next();!uL.done;uL=ry.next())(Jf=uL.value)&&(Q[Jf.key]=Jf);MC=g.m(B);for(nw=MC.next();!nw.done;nw=MC.next())Xk=
nw.value,e5=void 0,l[(e5=Xk.videoItem)!=null?e5:""]=!0,Xk.videoItem&&(T=mt=void 0,aO=(T=(mt=g.Pv(Xk.videoItem))==null?void 0:mt.entityId)!=null?T:"",C.push({externalVideoId:aO}));YW=N.filter(function(b){if(!b||!b.key||!b.offlineVideoPolicy)return!1;b=g.Pv(b.key).entityId;b=g.xv(b,"downloadStatusEntity");var Lw;return!(b&&((Lw=h[b])==null?void 0:Lw.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
R0=YW.map(function(b){var Lw=w[b.transfer],ro=[];if(Lw==null?0:Lw.offlineVideoStreams)for(var SZ=g.m(Lw.offlineVideoStreams),xg=SZ.next();!xg.done;xg=SZ.next())(xg=Q[xg.value])&&ro.push(xg);SZ=r[b.offlineVideoPolicy];xg=l;var R8=b==null?void 0:b.playerResponseTimestamp,a0=g.Pv(SZ.key).entityId;b=g.xv(a0,"mainVideoEntity");if(SZ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var oO="OFFLINE_VIDEO_STATE_DISABLED";SZ.expirationTimestamp&&Number(SZ.expirationTimestamp)<Date.now()/1E3&&(oO="OFFLINE_VIDEO_STATE_EXPIRED")}else if(SZ.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")oO="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Lw==null?void 0:Lw.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":oO="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":oO="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":oO="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":oO="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":oO="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":oO="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:oO="OFFLINE_VIDEO_STATE_UNKNOWN"}if(oO==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Lw==null?void 0:Lw.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":oO="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":oO="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":oO=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}a0={id:a0,videoState:oO};if(Lw==null?0:Lw.cotn)a0.cotn=Lw.cotn;if(Lw==null?0:Lw.maximumDownloadQuality)a0.selectedVideoQuality=Lw==null?void 0:Lw.maximumDownloadQuality;if(Lw==null?0:Lw.lastProgressTimeMs)a0.lastProgressTimeMs=Lw.lastProgressTimeMs;R8&&(a0.playerResponseSavedTimeMs=String(Number(R8)*1E3));Lw=String;R8=0;ro=g.m(ro);for(oO=ro.next();!oO.done;oO=ro.next())if(oO=oO.value,oO.streamsProgress){oO=g.m(oO.streamsProgress);for(var tO=oO.next();!tO.done;tO=
oO.next()){var k=void 0;R8+=Number((k=tO.value.numBytesDownloaded)!=null?k:0)}}a0.downloadedBytes=Lw(R8);a0.selectedOfflineMode=xg[b]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";SZ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(a0.offlinePlaybackDisabledReason=SZ.offlinePlaybackDisabledReason);return a0});
return TK.return({offlineVideos:R0,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:C}}})})},OtX=function(){this.locks=navigator.locks},Eef=function(){try{var A=g.bB("ytglobal.locks_");
if(A)return A;var L;if(L=navigator){var B=navigator;L="locks"in B&&!!B.locks}if(L)return g.rI.localStorage&&g.rI.localStorage.getItem("noop"),A=new OtX,g.hf("ytglobal.locks_",A),A}catch(f){}},uU=function(){},c5w=function(){},MOX=function(A){if(A.includes(":"))throw Error("Invalid user cache name: "+A);
return A+":"+g.nn("CacheStorage get")},Y3O=function(){return g.c(function(A){if(an!==void 0)return A.return(an);
an=new Promise(function(L){var B;return g.c(function(f){switch(f.N){case 1:return g.S5(f,2),g.X(f,AH.open("test-only"),4);case 4:return g.X(f,AH.delete("test-only"),5);case 5:g.ZR(f,3);break;case 2:if(B=g.NX(f),B instanceof Error&&B.name==="SecurityError")return L(!1),f.return();case 3:L("caches"in window),g.VK(f)}})});
return A.return(an)})},Wst=function(){return g.c(function(A){if(A.N==1)return g.X(A,Y3O(),2);
if(!A.W)return A.return(void 0);Un9||(Un9=new c5w);return A.return(Un9)})},LB=function(A,L,B){g.CE(new g.iL("Woffle: "+A,B?{cotn:B}:""));
L instanceof Error&&g.CE(L)},veX=function(A){var L;
return g.c(function(B){if(B.N==1)return g.X(B,XrO(A),2);L=B.W;g.pE("offlineStateSnapshot",L);g.VK(B)})},oi=function(A){g.Y.call(this);
var L=this;this.api=A;this.GV={PAF:function(){return L.N},
D2n:function(){return L.W}};
typeof g.rI.BroadcastChannel!=="undefined"&&(this.N=new g.rI.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.nn()),this.N.onmessage=this.V.bind(this),this.W=new g.rI.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.nn()),this.W.onmessage=this.U.bind(this))},Bn=function(A,L){A.api.Kr("onOfflineOperationFailure",L);
var B;(B=A.N)==null||B.postMessage(L)},q3w=function(A,L,B){var f=this;
this.G=A;this.yj=L;this.visibility=B;this.D=this.X=this.T=this.V=this.N=!1;this.U=new g.aa(function(){f.VV()});
this.GV={II:function(){return f.W},
VV:function(){f.VV()},
iuL:function(){return f.U}};
this.visibility.subscribe("visibilitystatechange",function(){f.wI()})},PHK=function(A){if(!A.V&&!A.N){var L=Eef();
if(L){A.V=!0;var B=g.nn("OfflineLockManager");L.request("woffle_orchestration_leader:"+B,{},function(){var f,K;return g.c(function(V){switch(V.N){case 1:return g.S5(V,2),A.W=new g.IQ,A.N=!0,A.V=!1,g.X(V,A.G(),4);case 4:return g.X(V,A.W.promise,5);case 5:g.ZR(V,0);break;case 2:f=g.NX(V),A.VV(),f instanceof Error&&(K=f,K.args=[{name:"WoLockManagerError",YK:f.name}],g.mL(K)),g.VK(V)}})})}}},xnK=function(A){A.N&&(A.D=!0,fB(A))},eNf=function(A,L){A.N&&(A.T=L,fB(A))},net=function(A,L){A.N&&(A.X=L,fB(A))},
fB=function(A){A.X&&A.T&&A.D&&A.visibility.isBackground()?g.Az(A.U,6E4):A.U.stop()},KB=function(A){var L;
A.offlineDeleteReason=(L=A.offlineDeleteReason)!=null?L:"OFFLINE_DELETE_REASON_UNKNOWN";var B;A.offlineModeType=(B=A.offlineModeType)!=null?B:"OFFLINE_NOW";g.pE("offlineDeleteEvent",A)},VZ=function(A,L){var B=L.videoId;
var f=L.RU;L=L.offlineModeType;A.encryptedVideoId=B;A.cotn=f==null?void 0:f.cotn;A.offlineabilityFormatType=f==null?void 0:f.maximumDownloadQuality;var K;A.isRefresh=(K=f==null?void 0:f.isRefresh)!=null?K:!1;var V;A.softErrorCount=(V=f==null?void 0:f.transferRetryCount)!=null?V:0;A.offlineModeType=L!=null?L:"OFFLINE_NOW";(A.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&A.statusType==="UNKNOWN_STATUS_TYPE"||!A.transferStatusType&&!A.statusType)&&g.CE(Error("Woffle unknown transfer status"));
g.pE("offlineTransferStatusChanged",A)},zNK=function(A){VZ({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},A)},uxO=function(A,L,B,f){f={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!f};L&&B&&(L=Math.floor(L/1024).toFixed(),B=Math.floor(B/1024).toFixed(),f.alreadyDownloadedKbytes=L,f.totalFetchedKbytes=L,f.totalContentKbytes=B);VZ(f,A)},akI=function(A){VZ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},A)},A9t=function(A){VZ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},A)},LQW=function(A){switch(A){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
JH=function(A){var L,B,f;
return((f=(L=A.actionMetadata)==null?void 0:(B=L.retryScheduleIntervalsInSeconds)==null?void 0:B.length)!=null?f:0)>0},SI=function(A){return A.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!A.entityKey},Ri=function(A){return A.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!A.entityKey},Ze=function(A){return A.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!A.entityKey},oZ9=function(A){return A.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!A.entityKey},
N6=function(A,L,B,f,K){K=K===void 0?!1:K;
var V,J,R,Z,N,F;return g.c(function(D){if(D.N==1)return V=g.xv(A,L),J=g.xv(A,"downloadStatusEntity"),g.X(D,Px(B,{mode:"readonly",Ev:!0},function(I){return g.r2.all([cx(I,V,L),cx(I,J,"downloadStatusEntity")])}),2);
R=D.W;Z=R.length?R[0]:void 0;if(!Z)return D.Ux(0);N=BmK;if(F=R.length>1?R[1]:void 0){if(F.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!K)return D.return();F.downloadState=f}else F={key:J,downloadState:f};g.cb(Z,N,F);return g.X(D,Px(B,{mode:"readwrite",Ev:!0},function(I){return g.r2.all([Uo(I,Z,L),Uo(I,F,"downloadStatusEntity")])}),0)})},FG=function(A,L){return A.actionType===L.actionType&&A.entityKey===L.entityKey},De=function(A,L){if(A&&A.transferState!=="TRANSFER_STATE_COMPLETE"&&A.transferState!==
"TRANSFER_STATE_FAILED"){var B=g.Pv(A.key).entityId;
VZ({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:B,RU:A,offlineModeType:L})}},dB=function(A){if(!A||!A.thumbnails)return[];
var L=[];A=g.m(A.thumbnails);for(var B=A.next();!B.done;B=A.next())B=B.value,B.url&&L.push(B.url);return L},faf=function(A,L,B){B=B===void 0?[]:B;
var f,K,V,J,R,Z,N,F,D,I,d,w,r;return g.c(function(h){if(h.N==1)return B.length?g.X(h,n7(A,L),2):h.return([]);f=h.W;K=new Set;V=g.m(f);for(J=V.next();!J.done;J=V.next())if(R=J.value,Z=R.id||R.key)N=g.Pv(Z).entityId,K.add(N);F=[];D=g.m(B);for(I=D.next();!I.done;I=D.next())d=I.value,w=d.offlineVideoData,r=void 0,((r=w)==null?0:r.videoId)&&!K.has(w.videoId)&&F.push(d);return h.return(F)})},KQW=function(A,L,B){return new g.Kr(A,{cotn:L,
raw_player_response:B,download_media:!0,start:Infinity,disable_watch_next:!0})},VWB=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Ii=function(A,L,B,f,K,V,J,R,Z,N,F){this.entityType=A;
this.actionId=L;this.action=B;this.parentActionId=f;this.rootActionId=K===void 0?L:K;this.childActionIds=V;this.prereqActionId=J;this.postreqActionIds=R;this.hasChildActionFailed=N;this.retryScheduleIndex=0;this.N=F||Date.now();this.retryScheduleIndex=Z||0},wB=function(A){if(!A.key)throw Error("Entity key is required.");
if(!A.actionProto)throw Error("OfflineOrchestrationAction is required.");var L=g.Pv(A.key),B=g.Pv(A.actionProto.entityKey);return new Ii(B.entityType,L.entityId,A.actionProto,A.parentActionId,A.rootActionId,A.childActionIds,A.prereqActionId,A.postreqActionIds,A.retryScheduleIndex,A.hasChildActionFailed,Number(A.enqueueTimeSec)*1E3)},pB=function(A){return{key:g.xv(A.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:A.action,parentActionId:A.parentActionId,rootActionId:A.rootActionId,childActionIds:A.childActionIds,prereqActionId:A.prereqActionId,postreqActionIds:A.postreqActionIds,retryScheduleIndex:A.retryScheduleIndex,hasChildActionFailed:A.hasChildActionFailed,enqueueTimeSec:(A.N/1E3).toFixed()}},J9K=function(){var A;
return g.c(function(L){return L.N==1?g.X(L,Wst(),2):(A=L.W)?L.return(A.delete("yt-player-local-img")):L.return(!0)})},yZ=function(A){var L,B;
return g.c(function(f){if(f.N==1)return g.X(f,Wst(),2);if(f.N!=3){L=f.W;if(!L)throw Error("Cache API not supported");return A.length?g.X(f,L.open("yt-player-local-img"),3):f.return()}B=f.W;return g.X(f,Promise.all(A.map(function(K){return B.delete(K)})),0)})},jI=function(A){var L,B;
return g.c(function(f){if(f.N==1)return g.X(f,Wst(),2);if(f.N!=3){L=f.W;if(!L)throw Error("Cache API not supported");return A.length?g.X(f,L.open("yt-player-local-img"),3):f.return()}B=f.W;return g.X(f,B.addAll(A),0)})},gB=function(A,L,B,f,K){var V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw,Xk,e5;
return g.c(function(mt){switch(mt.N){case 1:return V=g.xv(A,"mainVideoEntity"),J=g.xv(A,"ytMainChannelEntity"),R=g.xv(A,"transfer"),Z=g.xv(A,"videoDownloadContextEntity"),g.X(mt,Px(L,{mode:"readonly",Ev:!0},function(T){return g.r2.all([cx(T,V,"mainVideoEntity"),cx(T,J,"ytMainChannelEntity"),cx(T,R,"transfer"),cx(T,Z,"videoDownloadContextEntity"),Mk(T,"ytMainChannelEntity"),Mk(T,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:N=mt.W;F=g.m(N);D=F.next().value;I=F.next().value;d=F.next().value;w=F.next().value;r=F.next().value;h=F.next().value;Q=D;l=I;C=d;O=w;v=r;U=h;if(!Q&&!l){mt.Ux(3);break}a=Q?dB(Q.thumbnail):[];if(!l){o0=[];mt.Ux(4);break}return g.X(mt,Saw(l,v),5);case 5:o0=mt.W;case 4:return B6=o0,g.X(mt,yZ(a.concat(B6)),3);case 3:Ve=[];DS=g.xv(A,"downloadStatusEntity");fw=g.m(U);for(ry=fw.next();!ry.done;ry=fw.next())uL=ry.value,Jf=g.Pv(uL.key).entityId,MC=wB(uL),nw=g.Pv(MC.action.entityKey).entityId,Jf!==A&&
nw!==A||FG(B,uL.actionProto)||Ve.push(uL.key);return g.X(mt,Px(L,{mode:"readwrite",Ev:!0},function(T){var aO=Ve.map(function(YW){return Wx(T,YW)});
aO.push(Wx(T,V,{u8:!0}));aO.push(Wx(T,DS,{u8:!0}));return g.r2.all(aO)}),7);
case 7:e5=(Xk=O)==null?void 0:Xk.offlineModeType,K&&(KB(K),K.offlineModeType&&(e5=K.offlineModeType)),De(C,e5),Bn(f,{entityKey:V,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.VK(mt)}})},Nmf=function(A,L,B,f){var K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw,Xk,e5,mt,T,aO,YW,R0,TK,b,Lw,ro,SZ,xg,R8,a0,oO,tO,k,H,t;
return g.c(function(E){switch(E.N){case 1:return K=g.xv(A,"mainPlaylistEntity"),V=g.xv(A,"ytMainChannelEntity"),g.X(E,Px(L,{mode:"readonly",Ev:!0},function(e){return g.r2.all([cx(e,K,"mainPlaylistEntity"),cx(e,V,"ytMainChannelEntity"),Mk(e,"mainPlaylistEntity"),Mk(e,"mainDownloadsListEntity"),Mk(e,"ytMainChannelEntity"),Mk(e,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:J=E.W;R=g.m(J);Z=R.next().value;N=R.next().value;F=R.next().value;D=R.next().value;I=R.next().value;d=R.next().value;w=Z;r=N;h=F;Q=D;l=I;C=d;if(!w&&!r){E.Ux(3);break}O=w?Rj5(w):[];if(!r){v=[];E.Ux(4);break}return g.X(E,Saw(r,l),5);case 5:v=E.W;case 4:return U=v,g.X(E,yZ(O.concat(U)),3);case 3:a=[];o0=new Map;if(!w){E.Ux(7);break}return g.X(E,ZcI(w,h,Q),8);case 8:a=E.W;B6=g.m(a);for(Ve=B6.next();!Ve.done;Ve=B6.next())DS=Ve.value,o0.set(DS,{videoId:DS,playlistId:A,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.X(E,Px(L,{mode:"readonly",Ev:!0},function(e){return g.r2.all([Mk(e,"transfer"),Mk(e,"videoDownloadContextEntity")])}),9);
case 9:fw=E.W;ry=g.m(fw);uL=ry.next().value;Jf=ry.next().value;MC=uL;nw=Jf;Xk=g.m(MC);for(e5=Xk.next();!e5.done;e5=Xk.next())mt=e5.value,T=g.Pv(mt.key).entityId,(aO=o0.get(T))&&mt&&(aO.cotn=mt.cotn);YW=g.m(nw);for(R0=YW.next();!R0.done;R0=YW.next())TK=R0.value,b=g.Pv(TK.key).entityId,(Lw=o0.get(b))&&TK&&(Lw.offlineModeType=TK.offlineModeType);case 7:ro=[];SZ=g.m(C);for(xg=SZ.next();!xg.done;xg=SZ.next())R8=xg.value,a0=g.Pv(R8.key).entityId,oO=wB(R8),a0!==A&&oO.rootActionId!==A||FG(B,R8.actionProto)||
ro.push(R8.key);tO=g.xv(A,"mainPlaylistEntity");return g.X(E,Px(L,{mode:"readwrite",Ev:!0},function(e){var SE=ro.map(function(z){return Wx(e,z)});
SE.push(Wx(e,tO,{u8:!0}));return g.r2.all(SE)}),10);
case 10:if(!w){E.Ux(0);break}a.reverse();if(!a){E.Ux(0);break}k=g.m(a);H=k.next();case 13:if(H.done){E.Ux(0);break}t=H.value;return g.X(E,gB(t,L,B,f,o0.get(t)),14);case 14:H=k.next(),E.Ux(13)}})},DOX=function(A,L,B,f){var K,V,J,R,Z,N,F,D,I;
return g.c(function(d){if(d.N==1)return K=g.xv("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),V=new Map,g.X(d,Px(A,{mode:"readwrite",Ev:!0},function(w){var r=Mk(w,"transfer"),h=Mk(w,"offlineOrchestrationActionWrapperEntity"),Q=Mk(w,"videoDownloadContextEntity"),l=cx(w,K,"mainDownloadsListEntity");return g.r2.all([r,h,Q,l]).then(function(C){C=g.m(C);var O=C.next().value;var v=C.next().value;var U=C.next().value;var a=C.next().value;C=FQK.map(function(B6){return J5K(w,B6)});
v=g.m(v);for(var o0=v.next();!o0.done;o0=v.next())o0=o0.value,FG(L,o0.actionProto)||C.push(Wx(w,o0.key,{u8:!0}));a&&(a.downloads=[],C.push(Uo(w,a,"mainDownloadsListEntity")));if(U)for(U=g.m(U),a=U.next();!a.done;a=U.next())a=a.value,v=g.Pv(a.key).entityId,v=g.xv(v,"transfer"),V.set(v,a.offlineModeType);return g.r2.all(C).then(function(){return O})})}),2);
J=d.W;R=g.m(J);for(Z=R.next();!Z.done;Z=R.next())N=Z.value,De(N,V.get(N.key)),F=g.Pv(N.key).entityId,D={videoId:F,offlineDeleteReason:f,cotn:N.cotn,offlineModeType:V.get(N.key)},KB(D),I=g.xv(F,"mainVideoEntity"),Bn(B,{entityKey:I,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.X(d,J9K(),0)})},Rj5=function(A,L){var B=[];
if(A.thumbnailStyleData){A=g.m(A.thumbnailStyleData);for(var f=A.next();!f.done;f=A.next()){var K=void 0,V=void 0,J=void 0;B=B.concat(dB((K=f.value)==null?void 0:(V=K.value)==null?void 0:(J=V.collageThumbnail)==null?void 0:J.coverThumbnail))}}L=dB(L);return B.concat(L)},ZcI=function(A,L,B){var f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6;
return g.c(function(Ve){f=[];K=new Set;if(B.length)for(V=g.m(B),J=V.next();!J.done;J=V.next())if(R=J.value,Z=void 0,(Z=R.downloads)==null?0:Z.length)for(N=g.m(R.downloads),F=N.next();!F.done;F=N.next())D=F.value,D.videoItem&&(I=g.Pv(D.videoItem).entityId,K.add(I));if(A.videos){d=g.m(A.videos);for(w=d.next();!w.done;w=d.next())r=w.value,h=JSON.parse(g.Pv(r).entityId),h.videoId&&!K.has(h.videoId)&&f.push(h.videoId);Q=g.m(L);for(l=Q.next();!l.done;l=Q.next())if(C=l.value,C.key!==A.key&&(O=C.videos))for(v=
g.m(O),U=v.next();!U.done;U=v.next())a=U.value,o0=JSON.parse(g.Pv(a).entityId),o0.videoId&&(B6=f.indexOf(o0.videoId),B6!==-1&&f.splice(B6,1))}return Ve.return(f)})},Saw=function(A,L){var B,f,K,V,J,R,Z,N;
return g.c(function(F){B=dB(A.avatar);f=g.m(L);for(K=f.next();!K.done;K=f.next())if(V=K.value,V.id!==A.id)for(J=g.m(dB(V.avatar)),R=J.next();!R.done;R=J.next())Z=R.value,N=B.indexOf(Z),N!==-1&&B.splice(N,1);return F.return(B)})},dOK=function(A){var L;
return g.c(function(B){L=g.y(A.frameworkUpdates,Gf);return A.frameworkUpdates&&L?g.X(B,ge9(L),0):B.return()})},w3X=function(A){var L;
if((L=A.onResponseReceivedActions)!=null&&L.length){var B;A=(B=g.y(g.y(A.onResponseReceivedActions[0],IaW),g.yff))==null?void 0:B.actions;if(A!=null&&A.length)return A}},p3w=function(A){var L,B,f;
return g.c(function(K){if(K.N==1)return A?g.X(K,eJ(A,g.CI,"mainDownloadsListEntity"),2):K.return([]);L=K.W;return((B=L)==null?0:(f=B.downloads)==null?0:f.length)?K.return(L.downloads.map(function(V){var J;return(J=V.videoItem)!=null?J:""})):K.return([])})},jxt=function(A,L){var B;
return g.c(function(f){return f.N==1?g.X(f,y9f(A,L),2):(B=f.W)?g.X(f,Px(A,{mode:"readwrite",Ev:!0},function(K){var V=[Uo(K,B.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];B.mainDownloadsListEntity&&V.push(Uo(K,B.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.r2.all(V)}),0):f.Ux(0)})},y9f=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C;
return g.c(function(O){if(O.N==1)return B=g.xv("main_downloads_library_id","mainDownloadsLibraryEntity"),f=g.xv("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.X(O,Px(A,{mode:"readonly",Ev:!0},function(v){return g.r2.all([cx(v,B,"mainDownloadsLibraryEntity"),cx(v,f,"mainDownloadsListEntity")])}),2);
K=O.W;V=g.m(K);J=V.next().value;R=V.next().value;Z=J;N=R;Z||(Z={id:B});F=g.m(L);for(D=F.next();!D.done;D=F.next())if(I=D.value,I===g.CI){if(Z.smartDownloadsList)return O.return();Z.smartDownloadsList=I}else if(d=g.Pv(I).entityType,w={},d==="mainPlaylistEntity"?w.playlistItem=I:d==="mainVideoEntity"&&(w.videoItem=I),!g.mi(w)){r=void 0;if((r=N)==null?0:r.downloads){h=!1;Q=g.m(N.downloads);for(l=Q.next();!l.done;l=Q.next())if(C=l.value,C.playlistItem===I||C.videoItem===I){h=!0;break}h||N.downloads.push(w)}else N=
{id:f,downloads:[w]};Z.downloadsList=f}return O.return({mainDownloadsLibraryEntity:Z,mainDownloadsListEntity:N})})},gZI=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h;
return g.c(function(Q){if(Q.N==1)return B=g.xv("main_downloads_library_id","mainDownloadsLibraryEntity"),f=g.xv("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.X(Q,Px(A,{mode:"readonly",Ev:!0},function(l){return g.r2.all([cx(l,B,"mainDownloadsLibraryEntity"),cx(l,f,"mainDownloadsListEntity"),cx(l,g.CI,"mainDownloadsListEntity")])}),2);
K=Q.W;V=g.m(K);J=V.next().value;R=V.next().value;Z=V.next().value;N=J;F=R;D=Z;if(!N)return Q.Ux(0);if(L===g.CI&&((I=D)==null?0:I.downloads))D.downloads=[];else if((d=F)==null?0:d.downloads)for(w=g.Pv(L).entityType,r=0;r<F.downloads.length;r++)if(h=F.downloads[r],w==="mainVideoEntity"&&h.videoItem===L){F.downloads.splice(r,1);break}else if(w==="mainPlaylistEntity"&&h.playlistItem===L){F.downloads.splice(r,1);break}return g.X(Q,Px(A,{mode:"readwrite",Ev:!0},function(l){var C=[Uo(l,N,"mainDownloadsLibraryEntity")];
F&&C.push(Uo(l,F,"mainDownloadsListEntity"));D&&C.push(Uo(l,D,"mainDownloadsListEntity"));return g.r2.all(C)}),0)})},rB=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I;
return g.c(function(d){if(d.N==1)return B=g.xv(L,"transfer"),f=g.xv(L,"videoDownloadContextEntity"),g.X(d,Px(A,{mode:"readonly",Ev:!0},function(w){return g.r2.all([cx(w,B,"transfer"),cx(w,f,"videoDownloadContextEntity")])}),2);
K=d.W;V=g.m(K);J=V.next().value;R=V.next().value;Z=J;N=R;I={videoId:L,cotn:(F=Z)==null?void 0:F.cotn,offlineModeType:(D=N)==null?void 0:D.offlineModeType};return d.return(I)})},s8=function(A,L,B,f,K){var V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0;
return g.c(function(B6){switch(B6.N){case 1:return V=g.xv(A,"musicTrack"),J=g.xv(A,"transfer"),g.X(B6,Px(L,{mode:"readonly",Ev:!0},function(Ve){return g.r2.all([cx(Ve,V,"musicTrack"),cx(Ve,J,"transfer"),Mk(Ve,"musicTrack"),Mk(Ve,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:R=B6.W;Z=g.m(R);N=Z.next().value;F=Z.next().value;D=Z.next().value;I=Z.next().value;d=N;w=F;r=D;h=I;if(!d){B6.Ux(3);break}return g.X(B6,G1t(d,r),4);case 4:return Q=B6.W,g.X(B6,yZ(Q),3);case 3:l=[];C=g.m(h);for(O=C.next();!O.done;O=C.next())v=O.value,U=g.Pv(v.key).entityId,a=wB(v),o0=g.Pv(a.action.entityKey).entityId,U!==A&&o0!==A||FG(B,v.actionProto)||l.push(v.key);return g.X(B6,Px(L,{mode:"readwrite",Ev:!0},function(Ve){var DS=l.map(function(fw){return Wx(Ve,fw)});
DS.push(Wx(Ve,V,{u8:!0}));return g.r2.all(DS)}),6);
case 6:De(w),K&&KB(K),Bn(f,{entityKey:V,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.VK(B6)}})},Hn=function(A,L,B,f,K){var V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw,Xk,e5,mt,T,aO,YW,R0;
return g.c(function(TK){switch(TK.N){case 1:return V=g.xv(A,L),J=g.xv("music_downloads_library_id","musicDownloadsLibraryEntity"),g.X(TK,Px(B,{mode:"readonly",Ev:!0},function(b){return g.r2.all([cx(b,V,L),cx(b,J,"musicDownloadsLibraryEntity"),Mk(b,L),Mk(b,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:R=TK.W;Z=g.m(R);N=Z.next().value;F=Z.next().value;D=Z.next().value;I=Z.next().value;d=N;w=F;r=D;h=I;if(!d){TK.Ux(3);break}return g.X(TK,G1t(d,r),4);case 4:return Q=TK.W,g.X(TK,yZ(Q),3);case 3:l=[];C=new Map;if(!d){TK.Ux(6);break}return g.X(TK,r9t(d,r,w),7);case 7:l=TK.W;O=g.m(l);for(v=O.next();!v.done;v=O.next())U=v.value,a=g.Pv(U).entityId,C.set(a,{videoId:a,playlistId:A,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.X(TK,n7(B,"transfer"),8);case 8:for(o0=TK.W,B6=
g.m(o0),Ve=B6.next();!Ve.done;Ve=B6.next())DS=Ve.value,fw=g.Pv(DS.key).entityId,(ry=C.get(fw))&&DS&&(ry.cotn=DS.cotn);case 6:uL=[];Jf=g.m(h);for(MC=Jf.next();!MC.done;MC=Jf.next())nw=MC.value,Xk=g.Pv(nw.key).entityId,e5=wB(nw),Xk!==A&&e5.rootActionId!==A||FG(f,nw.actionProto)||uL.push(nw.key);mt=g.xv(A,L);return g.X(TK,Px(B,{mode:"readwrite",Ev:!0},function(b){var Lw=uL.map(function(ro){return Wx(b,ro)});
Lw.push(Wx(b,mt,{u8:!0}));return g.r2.all(Lw)}),9);
case 9:if(!d){TK.Ux(0);break}l.reverse();if(!l.length){TK.Ux(0);break}T=g.m(l);aO=T.next();case 12:if(aO.done){TK.Ux(0);break}YW=aO.value;R0=g.Pv(YW).entityId;if(!R0){TK.Ux(13);break}return g.X(TK,s8(R0,B,f,K,C.get(R0)),13);case 13:aO=T.next(),TK.Ux(12)}})},hH=function(A,L,B){var f,K,V,J,R,Z,N;
return g.c(function(F){if(F.N==1)return g.X(F,Px(A,{mode:"readwrite",Ev:!0},function(D){var I=Mk(D,"transfer"),d=Mk(D,"offlineOrchestrationActionWrapperEntity");return g.r2.all([I,d]).then(function(w){w=g.m(w);var r=w.next().value;var h=w.next().value;w=sxI.map(function(O){return J5K(D,O)});
h=g.m(h);for(var Q=h.next();!Q.done;Q=h.next()){Q=Q.value;var l=g.Pv(Q.actionProto.entityKey).entityType==="musicTrack",C=Q.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";FG(L,Q.actionProto)||l&&(!l||C)||w.push(Wx(D,Q.key,{u8:!0}))}return g.r2.all(w).then(function(){return r})})}),2);
f=F.W;K=g.m(f);for(V=K.next();!V.done;V=K.next())J=V.value,De(J),R=g.Pv(J.key).entityId,Z={videoId:R,offlineDeleteReason:void 0,cotn:J.cotn},KB(Z),N=g.xv(R,"musicTrack"),Bn(B,{entityKey:N,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.X(F,J9K(),0)})},Hcf=function(A){for(var L,B=g.m(A.additionalMetadatas),f=B.next();!f.done;f=B.next())f=f.value,f.offlineMusicVideoData&&(L=f.offlineMusicVideoData);
var K,V,J,R,Z;return{id:g.xv(A.videoId,"musicTrack"),videoId:A.videoId,title:A.title,thumbnailDetails:A.thumbnail,lengthMs:String(Number(A.lengthSeconds)*1E3),albumTitle:(K=L)==null?void 0:K.releaseTitle,musicVideoType:(V=L)==null?void 0:V.musicVideoType,contentRating:{explicitType:(J=L)==null?void 0:J.explicitType},artistNames:((R=L)==null?void 0:R.byline)||((Z=L)==null?void 0:Z.channelName),downloadMetadata:g.xv(A.videoId,"musicTrackDownloadMetadataEntity")}},r9t=function(A,L,B){var f,K,V,J,R,Z,
N,F,D,I,d,w,r,h,Q,l,C,O;
return g.c(function(v){f=[];K=new Set;if((V=B)==null?0:(J=V.downloadedTracks)==null?0:J.length)for(R=g.m(B.downloadedTracks),Z=R.next();!Z.done;Z=R.next())N=Z.value,K.add(N);if(A.tracks){F=g.m(A.tracks);for(D=F.next();!D.done;D=F.next())I=D.value,K.has(I)||f.push(I);d=g.m(L);for(w=d.next();!w.done;w=d.next())if(r=w.value,r.id!==A.id&&(h=r.tracks))for(Q=g.m(h),l=Q.next();!l.done;l=Q.next())C=l.value,O=f.indexOf(C),O!==-1&&f.splice(O,1)}return v.return(f)})},G1t=function(A,L){var B,f,K,V,J,R,Z,N;
return g.c(function(F){B=dB(A.thumbnailDetails);f=g.m(L);for(K=f.next();!K.done;K=f.next())if(V=K.value,V.id!==A.id)for(J=g.m(dB(V.thumbnailDetails)),R=J.next();!R.done;R=J.next())Z=R.value,N=B.indexOf(Z),N!==-1&&B.splice(N,1);return F.return(B)})},hjf=function(A,L){var B,f,K,V,J,R,Z,N,F;
return g.c(function(D){if(D.N==1)return B=g.xv("music_downloads_library_id","musicDownloadsLibraryEntity"),g.X(D,eJ(A,B,"musicDownloadsLibraryEntity"),2);(f=D.W)||(f={id:B});K=g.Pv(L).entityType;K==="musicTrack"?(V=f.downloadedTracks)!=null&&V.includes(L)||(f.downloadedTracks=((J=f.downloadedTracks)!=null?J:[]).concat(L)):K==="musicPlaylist"?(R=f.downloadedPlaylists)!=null&&R.includes(L)||(f.downloadedPlaylists=((Z=f.downloadedPlaylists)!=null?Z:[]).concat(L)):K!=="musicAlbumRelease"||(N=f.downloadedAlbumReleases)!=
null&&N.includes(L)||(f.downloadedAlbumReleases=((F=f.downloadedAlbumReleases)!=null?F:[]).concat(L));return g.X(D,xB(A,f,"musicDownloadsLibraryEntity"),0)})},bct=function(A,L){var B,f,K,V,J,R,Z;
return g.c(function(N){if(N.N==1)return B=g.xv("music_downloads_library_id","musicDownloadsLibraryEntity"),g.X(N,eJ(A,B,"musicDownloadsLibraryEntity"),2);f=N.W;if(!f)return N.Ux(0);K=g.Pv(L).entityType;K==="musicTrack"?V=f.downloadedTracks:K==="musicPlaylist"&&(V=f.downloadedPlaylists);if((J=V)==null?0:J.length)for(R=0;R<V.length;R++)if(Z=V[R],Z===L){V.splice(R,1);break}return g.X(N,xB(A,f,"musicDownloadsLibraryEntity"),0)})},tWd=function(A){var L=A.videos;
A=[];var B=[];if(L){L=g.m(L);for(var f=L.next();!f.done;f=L.next()){var K=f.value.offlineVideoData.videoId;f=g.xv(K,"musicTrack");K=g.xv(K,"musicTrackDownloadMetadataEntity");A.push(f);B.push(K)}}return{SA:A,RX:B}},bK=function(A,L,B){L={track:Hcf(L)};
B&&(L.playlistId=B);if(A=g.y(A.actionMetadata,k1f))L.maximumDownloadQuality=A.maximumDownloadQuality;return{musicTrackEntityActionMetadata:L}},lat=function(A){var L,B,f,K,V,J,R,Z;
return g.c(function(N){switch(N.N){case 1:return L=g.av(),B=kzf(A),f=g.B8(TmI),g.S5(N,2),V={er:!0},g.X(N,g.MD(L,B,f,void 0,V),4);case 4:K=N.W;g.ZR(N,3);break;case 2:J=g.NX(N);if(J instanceof g.n0)throw R="GetOffline network manager error: "+J.message,LB(R,J),Error(R);LB("GetOffline fetch request error",J);throw Error("GetOffline fetch request error");case 3:Z=tH(K);if(!K)throw LB("Network request failed"),Error("Network request failed");if(Z!==void 0)kJ(Z);else if(!K.videos||!K.videos.length)throw LB("No data"),
Error("No data");return N.return(K.videos.map(function(F){return F.offlineVideoData}))}})},mOf=function(A){var L,B,f,K,V,J,R,Z;
return g.c(function(N){switch(N.N){case 1:return L=g.av(),B=TV9(A),f=g.B8(TmI),g.S5(N,2),V={er:!0},g.X(N,g.MD(L,B,f,void 0,V),4);case 4:K=N.W;g.ZR(N,3);break;case 2:J=g.NX(N);if(J instanceof g.n0)throw R="GetOffline network manager error for playlist: "+J.message,LB(R,J),Error(R);LB("GetOffline fetch request error for playlist",J);throw Error("GetOffline fetch request error for playlist");case 3:Z=tH(K);if(!K)throw LB("Network request failed for playlist"),Error("Network request failed for playlist");
if(Z!==void 0)kJ(Z,"playlist");else if(!K.playlists||!K.playlists.length)throw LB("No data for playlist"),Error("No data for playlist");return N.return(K.playlists.map(function(F){return F.offlinePlaylistData}))}})},CmX=function(A,L,B,f){var K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw;
return g.c(function(Xk){switch(Xk.N){case 1:return g.X(Xk,zq(),2);case 2:K=Xk.W;if(!K)return Xk.return([]);V=[];if((J=f)==null?0:J.length){V=f;Xk.Ux(3);break}return g.X(Xk,n7(K,"mainPlaylistEntity"),4);case 4:V=Xk.W;case 3:if(!V.length)return Xk.return([]);R=[];Z=Date.now()/1E3;N=g.m(V);F=N.next();case 5:if(F.done)return R.length?g.X(Xk,Qxw(R),10):Xk.return([]);D=F.value;if(!D.downloadState){I=void 0;Xk.Ux(8);break}return g.X(Xk,eJ(K,D.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:I=
Xk.W;case 8:d=I;w=void 0;h=(r=(w=D)==null?void 0:w.entityMetadata)&&r.nextAutoRefreshIntervalSeconds?Number(r.nextAutoRefreshIntervalSeconds):NaN;Q=Number.isNaN(h)?A:h;C=l=void 0;O=((l=d)==null?0:l.lastSyncedTimestampMillis)?Number((C=d)==null?void 0:C.lastSyncedTimestampMillis)/1E3:0;U=v=void 0;a=((v=d)==null?0:v.addedTimestampMillis)?Number((U=d)==null?void 0:U.addedTimestampMillis)/1E3:0;if(B||!r||O+Q<=Z){o0=[];B6=void 0;if((B6=D.videos)==null?0:B6.length)for(Ve=g.m(D.videos),DS=Ve.next();!DS.done;DS=
Ve.next())fw=DS.value,ry=JSON.parse(g.Pv(fw).entityId),ry.videoId&&o0.push(ry.videoId);uL="0";r&&(Jf=void 0,uL=String(Number((Jf=r.offlineLastModifiedTimestampSeconds)!=null?Jf:0).toFixed()));MC={playlistId:D.playlistId,videoIds:o0,offlineLastModifiedTimestamp:uL,autoSync:L,offlineDateAddedTimestamp:String(a.toFixed())};R.push(MC)}F=N.next();Xk.Ux(5);break;case 10:return nw=Xk.W,Xk.return(nw)}})},icI=function(){var A,L,B,f,K;
return g.c(function(V){if(V.N==1)return g.X(V,zq(),2);if(V.N!=3)return(A=V.W)?g.X(V,n7(A,"refresh"),3):V.return(!1);L=V.W;if((B=L[0])==null||!B.refreshTime)return V.return(!1);f=Number(L[0].refreshTime);K=Date.now()/1E3;return V.return(isFinite(f)&&K>=f)})},X3t=function(A,L){var B,f,K;
return g.c(function(V){switch(V.N){case 1:return g.S5(V,2),g.X(V,$Ow(A,L),4);case 4:return f=V.W,g.X(V,dOK(f),5);case 5:B=w3X(f);g.ZR(V,3);break;case 2:K=g.NX(V),LB("getAndProcessSmartDownloadsResponse request or processing error",K);case 3:return V.return(B)}})},OcK=function(A,L,B,f){var K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw;
return g.c(function(Xk){switch(Xk.N){case 1:return g.X(Xk,zq(),2);case 2:K=Xk.W;if(!K)return Xk.return([]);V=[];if((J=f)==null?0:J.length){V=f;Xk.Ux(3);break}return g.X(Xk,n7(K,"musicPlaylist"),4);case 4:V=Xk.W;case 3:if(!V.length)return Xk.return([]);R=[];Z=Date.now()/1E3;N=g.m(V);F=N.next();case 5:if(F.done)return R.length?g.X(Xk,Qxw(R),10):Xk.return([]);D=F.value;I=void 0;w=(d=(I=D)==null?void 0:I.entityMetadata)&&d.nextAutoRefreshIntervalSeconds?Number(d.nextAutoRefreshIntervalSeconds):NaN;r=
Number.isNaN(w)?A:w;Q=h=0;l="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!D.downloadMetadata){Xk.Ux(8);break}return g.X(Xk,eJ(K,D.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:C=Xk.W,v=O=void 0,h=Number((v=(O=C)==null?void 0:O.addedTimestampMillis)!=null?v:"0")/1E3,a=U=void 0,Q=Number((a=(U=C)==null?void 0:U.lastModifiedTimestampMillis)!=null?a:"0")/1E3,B6=o0=void 0,l=(B6=(o0=C)==null?void 0:o0.syncState)!=null?B6:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Ve=void 0;if(B||l!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!d||Number((Ve=d.lastSyncedTimestampSeconds)!=null?Ve:0)+r<=Z){DS=[];fw=void 0;if((fw=D.tracks)==null?0:fw.length)for(ry=g.m(D.tracks),uL=ry.next();!uL.done;uL=ry.next())Jf=uL.value,DS.push(g.Pv(Jf).entityId);MC={playlistId:D.playlistId,videoIds:DS,offlineLastModifiedTimestamp:String(Q.toFixed()),autoSync:L,offlineDateAddedTimestamp:String(h.toFixed())};R.push(MC)}F=N.next();Xk.Ux(5);break;case 10:return nw=Xk.W,Xk.return(nw)}})},$Ow=function(A,L){var B,f,K,V,J,R,Z,N,F,D;
return g.c(function(I){switch(I.N){case 1:return B=g.av(),g.X(I,zq(),2);case 2:f=I.W;if(!f){I.Ux(3);break}return g.X(I,XrO(f),4);case 4:K=I.W;case 3:var d=K;V={context:g.AV(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:A},offlineClientState:d,clientStateRequestData:{preferredFormatType:L}}}};J=g.B8(EZK);g.S5(I,5);Z={er:!0};return g.X(I,g.MD(B,V,J,void 0,Z),7);case 7:R=I.W;g.ZR(I,6);break;case 5:N=g.NX(I);if(N instanceof g.n0)throw F=
"DPS network manager error for smart downloads: "+N.message,LB(F,N),Error(F);LB("DPS fetch request error for smart downloads",N);throw Error("DPS fetch request error for smart downloads");case 6:D=tH(R);if(R)D!==void 0&&kJ(D,"smart downloads");else throw LB("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return I.return(R)}})},MWd=function(A,L){var B,f,K,V,J,R,Z,N;
return g.c(function(F){switch(F.N){case 1:return B=g.av(),f={context:g.AV(),videoPlaybackPositionEntities:A,lastSyncTimestampUsec:L},K=g.B8(c9w),g.S5(F,2),J={er:!0},g.X(F,g.MD(B,f,K,void 0,J),4);case 4:V=F.W;g.ZR(F,3);break;case 2:R=g.NX(F);if(R instanceof g.n0)throw Z="VPPS network manager error: "+R.message,LB(Z,R),Error(Z);LB("VPPS fetch request error",R);throw Error("VPPS fetch request error");case 3:N=tH(V);if(V)N!==void 0&&kJ(N,"position sync");else throw LB("Network request failed for position sync"),
Error("Network request failed for position sync");return F.return(V)}})},UOf=function(A,L,B){var f,K,V,J,R,Z,N,F;
return g.c(function(D){switch(D.N){case 1:f=g.av();var I=B.refreshData,d=B.isEnqueuedForExpiredStreamUrlRefetch,w=B.PO,r=B.offlineSourceData,h=B.mediaCapabilities,Q={entityKey:A};I&&(Q.refreshData=I);d&&(Q.isExpiredStreamUrlRefetch=d);w&&(Q.downloadParameters=w);r&&(Q.offlineSourceData=r);I={context:g.DI(L),signatureTimestamp:20424,videos:[Q]};h&&(I.mediaCapabilities=h);K=I;V=g.B8(Ya5);g.S5(D,2);R={er:!0};return g.X(D,g.MD(f,K,V,void 0,R),4);case 4:J=D.W;g.ZR(D,3);break;case 2:Z=g.NX(D);if(Z instanceof
g.n0)throw N="GetPDE network manager error: "+Z.message,LB(N,Z),Error(N);LB("GetPDE fetch request error",Z);throw Error("GetPDE fetch request error");case 3:F=tH(J);if(J)F!==void 0&&kJ(F,"PDE");else throw LB("Network request failed for PDE"),Error("Network request failed for PDE");return D.return(J)}})},tH=function(A){var L;
return(L=A.errorMetadata)==null?void 0:L.status},kJ=function(A,L){L=L?" for "+L:"";
if(A===0)throw A="Empty response body"+L,LB(A),Error(A);A="Response with error"+L;LB(A);throw Error(A);},Qxw=function(A){var L,B,f,K,V,J,R,Z;
return g.c(function(N){switch(N.N){case 1:return L=g.av(),B=lkW(A),f=g.B8(WQR),g.S5(N,2),V={er:!0},g.X(N,g.MD(L,B,f,void 0,V),4);case 4:K=N.W;g.ZR(N,3);break;case 2:J=g.NX(N);if(J instanceof g.n0)throw R="offlinePlaylistSyncCheck network manager error: "+J.message,LB(R,J),Error(R);LB("offlinePlaylistSyncCheck fetch request error",J);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:Z=tH(K);if(!K)throw LB("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(Z!==void 0)kJ(Z,"playlist sync");else if(!K.offlinePlaylistSyncCheckDatas||!K.offlinePlaylistSyncCheckDatas.length)throw LB("No data for playlist sync"),Error("No data for playlist sync");return N.return(K.offlinePlaylistSyncCheckDatas.map(function(F){return F.offlinePlaylistSyncCheckData}))}})},Tf=function(A){this.N=A},vZw=function(A,L){var B,f,K,V,J,R;
return g.c(function(Z){switch(Z.N){case 1:B=new Map,f=g.m(L),K=f.next();case 2:if(K.done){Z.Ux(4);break}V=K.value;J=B;R=J.set;return g.X(Z,A.W(V),5);case 5:R.call(J,V,Z.W);K=f.next();Z.Ux(2);break;case 4:return Z.return(B)}})},lK=function(A,L,B,f,K,V){L=g.xv(L,B);
f=Object.assign({},V,{priority:f,retryScheduleIntervalsInSeconds:K});return{actionType:A,entityKey:L,actionMetadata:f}},m3=function(A,L,B,f,K,V){this.status=A;
this.N=L;this.U=B;this.W=f;this.V=K;this.downloadState=V},qa5=function(A,L,B){this.N=A;
this.L=L;this.V=B},ejd=function(A,L){var B,f,K,V,J,R,Z,N,F;
return g.c(function(D){switch(D.N){case 1:return B=L.entityKey,K=(f=g.y(L.actionMetadata,QZ))==null?void 0:f.isEnqueuedForExpiredStreamUrlRefetch,g.S5(D,2),V=void 0,g.X(D,Pm5(A,L),4);case 4:V=D.W;g.S5(D,5);var I=(I=g.y(L.actionMetadata,QZ))?{maximumDownloadQuality:I.maximumDownloadQuality}:void 0;return g.X(D,UOf(B,A.L,{isEnqueuedForExpiredStreamUrlRefetch:K,PO:I,offlineSourceData:V}),7);case 7:J=D.W;g.ZR(D,6,2);break;case 5:return g.NX(D,2),R=JH(L)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",LB("PDE handleAdd error"),D.return(CB(L,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",R,"DOWNLOAD_STATE_FAILED"));case 6:return g.X(D,xOf(A,J,L),8);case 8:return D.return(CB(L,!0,J.orchestrationActions));case 2:return Z=g.NX(D),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.Il&&Z.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),LB("PDE handleAdd error"),D.return(CB(L,!1,void 0,N,F,"DOWNLOAD_STATE_FAILED"))}})},uuK=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6;
return g.c(function(Ve){switch(Ve.N){case 1:return B=L.entityKey,f=g.Pv(B).entityId,g.X(Ve,Px(A.N,{mode:"readonly",Ev:!0},function(DS){var fw=cx(DS,B,"playbackData"),ry=cx(DS,g.xv(f,"offlineVideoPolicy"),"offlineVideoPolicy");DS=cx(DS,g.xv(f,"transfer"),"transfer");return g.r2.all([fw,ry,DS])}),2);
case 2:K=Ve.W;V=g.m(K);J=V.next().value;R=V.next().value;Z=V.next().value;N=J;F=R;D=Z;if(!N||!F)return Ve.return(CB(L,!0));I=[];r=((w=N)==null?0:w.playerResponseJson)?JSON.parse(N.playerResponseJson):null;if(!(D&&r&&A.L.J("html5_refresh_deprecated_downloads"))){Ve.Ux(3);break}d=nZ9(A,r,D);return g.X(Ve,zjR(A,D),4);case 4:I=Ve.W;case 3:h={lastPlayerResponseTimestampSeconds:N.playerResponseTimestamp,offlineToken:F.offlineToken,formatIds:I};Q={};if((l=D)==null?0:l.maximumDownloadQuality)Q.maximumDownloadQuality=
D.maximumDownloadQuality;g.S5(Ve,5);C=void 0;return g.X(Ve,Pm5(A,L),7);case 7:return C=Ve.W,g.S5(Ve,8),g.X(Ve,UOf(B,A.L,{refreshData:h,PO:Q,offlineSourceData:C,mediaCapabilities:d}),10);case 10:O=Ve.W;g.ZR(Ve,9,5);break;case 8:return g.NX(Ve,5),v=JH(L)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",LB("PDE handleRefresh error"),Ve.return(CB(L,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",v,"DOWNLOAD_STATE_FAILED"));
case 9:return g.X(Ve,xOf(A,O,L),11);case 11:return Ve.return(CB(L,!0,O.orchestrationActions));case 5:return U=g.NX(Ve),a="PDE handleRefresh error",U instanceof Error&&(a="PDE handleRefresh error: "+U.message),o0="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B6="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.Il&&U.type==="QUOTA_EXCEEDED"&&(o0="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",B6="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),LB(a),Ve.return(CB(L,
!1,void 0,o0,B6,"DOWNLOAD_STATE_FAILED"))}})},Pm5=function(A,L){var B,f,K,V;
return g.c(function(J){if(J.N==1)return B=g.Pv(L.entityKey).entityId,f=g.xv(B,"videoDownloadContextEntity"),g.X(J,eJ(A.N,f,"videoDownloadContextEntity"),2);K=J.W;return(V=K)!=null&&V.offlineModeType?J.return({offlineModeType:K.offlineModeType}):J.return(void 0)})},xOf=function(A,L,B){var f,K,V,J,R;
return g.c(function(Z){if(Z.N==1){if(!L.frameworkUpdates||!g.y(L.frameworkUpdates,Gf))return Z.return();if(!(g.y(L.frameworkUpdates,Gf).mutations&&g.y(L.frameworkUpdates,Gf).mutations.length>0&&g.y(L.frameworkUpdates,Gf).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return Z.Ux(2);f=g.Pv(g.y(L.frameworkUpdates,Gf).mutations[0].entityKey).entityId;return g.X(Z,rB(A.N,f),3)}if(Z.N!=2){K=Z.W;V=g.y(B.actionMetadata,QZ);if(R=(J=V)==null?void 0:J.playlistId)K.playlistId=R;K.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.SK(A.L)?g.X(Z,gB(f,A.N,B,A.V,K),2):g.cH(A.L)?g.X(Z,s8(f,A.N,B,A.V),2):Z.Ux(2)}return g.X(Z,ge9(g.y(L.frameworkUpdates,Gf)),0)})},CB=function(A,L,B,f,K,V){return new m3(L?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",JH(A),B,f,K,V)},nZ9=function(A,L,B){L=KQW(A.L,B.cotn,L);
B=g.Gp(L);return g.DPS(L,B,A.L)},zjR=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I;
return g.c(function(d){if(d.N==1)return B=[],g.X(d,Px(A.N,{mode:"readonly",Ev:!0},function(w){var r=[],h=L.offlineVideoStreams;if(h){h=g.m(h);for(var Q=h.next();!Q.done;Q=h.next())r.push(cx(w,Q.value,"offlineVideoStreams"))}return g.r2.all(r)}),2);
if(f=d.W)for(K=g.m(f),V=K.next();!V.done;V=K.next())if(J=V.value,R=void 0,(R=J)==null?0:R.streamsProgress)for(Z=J.streamsProgress,N=0;N<Z.length;N++)F=Z[N],D=JSON.parse(F.formatStreamBytes),I={itag:D.itag,lmt:D.lastModified,xtags:D.xtags},B.push(I);return d.return(B)})},aaB=function(A,L){this.N=A;
this.L=L},AUW=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d;
return g.c(function(w){switch(w.N){case 1:return B=JH(L),g.X(w,n7(A.N,"videoPlaybackPositionEntity"),2);case 2:f=w.W;if(f.length===0)return w.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));g.S5(w,3);return g.X(w,XD.getInstance(),5);case 5:K=w.W;if(!K)throw Error("prefStorage is undefined");return g.X(w,K.get("psi"),6);case 6:return V=w.W,Z=(R=(J=V)==null?void 0:J.Mw)!=null?R:"0",g.X(w,MWd(f,Z),7);case 7:return N=w.W,F={isPaused:N.watchHistoryPaused,Mw:N.syncTimestampUsec},g.X(w,K.set("psi",
F),8);case 8:if(F.isPaused){w.Ux(9);break}D=g.y(N.frameworkUpdates,Gf);if(!N.frameworkUpdates||!D){w.Ux(9);break}return g.X(w,ge9(D),9);case 9:g.ZR(w,4);break;case 3:return I=g.NX(w),d="PPE handleRefresh error: "+(I instanceof Error?I.message:"unknown error"),LB(d),w.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return w.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B))}})},oAf=function(A,L){var B,f,K,V,J,R,Z,N;
return g.c(function(F){switch(F.N){case 1:return B=JH(L),f=g.Pv(L.entityKey).entityId,g.S5(F,2),g.X(F,XD.getInstance(),4);case 4:K=F.W;if(!K)throw Error("prefStorage is undefined");return g.X(F,K.get("psi"),5);case 5:V=F.W;J=g.y(L.actionMetadata,LNO);if(((R=V)==null?void 0:R.isPaused)!==!1||(Z=J)==null||!Z.lastPlaybackPositionSeconds){F.Ux(6);break}N={key:g.xv(f,"videoPlaybackPositionEntity"),videoId:f,lastPlaybackPositionSeconds:J.lastPlaybackPositionSeconds};return g.X(F,xB(A.N,N,"videoPlaybackPositionEntity"),
6);case 6:g.ZR(F,3);break;case 2:return g.NX(F),F.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return F.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B))}})},Bb9=function(A,L){var B,f,K;
return g.c(function(V){switch(V.N){case 1:B=JH(L);g.S5(V,2);f=g.Pv(L.entityKey).entityId;if(f==="!*$_ALL_ENTITIES_!*$")return g.X(V,IkW(A.N),5);K=g.xv(f,"videoPlaybackPositionEntity");return g.X(V,dnt(A.N,K),5);case 5:g.ZR(V,3);break;case 2:return g.NX(V),V.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B))}})},fmB=function(A,L){this.api=A;
this.N=L;this.logger=new g.sI("woffle");this.W=!1;this.GV={r8:this.r8}},KNf=function(A){return g.c(function(L){return L.return(tOw(A))})},VaB=function(A){var L;
return g.c(function(B){if(B.N==1)return g.X(B,g.HJ6(A),2);L=B.W;return B.return(L.filter(function(f){return!!f.url}).map(function(f){return f.url}))})},iK=function(A,L){var B=g.vN(L);
if(B===1||B===0)return Promise.resolve();(B=JUw(A,L))&&B.stopVideo();A.V=0;return KNf(L)},$J=function(A,L,B,f){B=B===void 0?!1:B;
f=f===void 0?!0:f;L=typeof L==="string"?L:L.videoDetails.videoId;if(g.vN(L)===2){var K=JUw(A,L);K&&K.stopVideo();g.qg(L,2);A.V=2;B?SEd(A.N):f&&RqW(A.N)}},JUw=function(A,L){var B;
return((B=A.player)==null?void 0:B.getVideoData().videoId)===L?A.player:null},Z8R=function(A,L){this.N=A;
this.L=L},FNB=function(A,L){var B,f;
return g.c(function(K){switch(K.N){case 1:return B=JH(L),g.X(K,eJ(A.N,L.entityKey,"transfer"),2);case 2:if(f=K.W)return K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));g.S5(K,3);return g.X(K,NbK(A,L),5);case 5:g.ZR(K,4);break;case 3:return g.NX(K),K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B))}})},DBX=function(A,L){var B,f;
return g.c(function(K){switch(K.N){case 1:return B=JH(L),g.X(K,eJ(A.N,L.entityKey,"transfer"),2);case 2:f=K.W;if(!f||f.transferState!=="TRANSFER_STATE_COMPLETE")return K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));g.S5(K,3);return g.X(K,NbK(A,L,!0),5);case 5:g.ZR(K,4);break;case 3:return g.NX(K),K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B))}})},dB9=function(A,L){var B,f,K,V,J,R,Z,N,F,D;
return g.c(function(I){switch(I.N){case 1:return B=JH(L),f=g.Pv(L.entityKey).entityId,g.X(I,Px(A.N,{mode:"readonly",Ev:!0},function(d){var w=cx(d,L.entityKey,"transfer");d=cx(d,g.xv(f,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.r2.all([w,d])}),2);
case 2:K=I.W;V=g.m(K);J=V.next().value;R=V.next().value;Z=J;N=R;if(!Z||Z.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return I.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));g.S5(I,3);Z.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.X(I,xB(A.N,Z,"transfer"),5);case 5:F=g.Pv(Z.key).entityId;akI({videoId:F,RU:Z,offlineModeType:(D=N)==null?void 0:D.offlineModeType});g.ZR(I,4);break;case 3:return g.NX(I),I.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return I.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B))}})},NbK=function(A,L,B){B=B===void 0?!1:B;
var f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q;return g.c(function(l){switch(l.N){case 1:return f=g.y(L.actionMetadata,ImX),K=g.Pv(L.entityKey).entityId,V=g.xv(K,"downloadStatusEntity"),g.X(l,Px(A.N,{mode:"readonly",Ev:!0},function(C){var O=cx(C,V,"downloadStatusEntity");C=cx(C,g.xv(K,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.r2.all([O,C])}),2);
case 2:return J=l.W,R=g.m(J),Z=R.next().value,N=R.next().value,F=Z,D=N,I="TRANSFER_STATE_TRANSFER_IN_QUEUE",((d=F)==null?void 0:d.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(I="TRANSFER_STATE_PAUSED_BY_USER"),h={key:L.entityKey,transferState:I,cotn:g.y0(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(w=f)==null?void 0:w.maximumDownloadQuality,preferredAudioTrack:(r=f)==null?void 0:r.preferredAudioTrack,transferRetryCount:0,isRefresh:B,hasLoggedFirstStarted:!1},g.X(l,Px(A.N,
{mode:"readwrite",Ev:!0},function(C){var O=[];B&&O.push(Wx(C,g.xv(K,"offlineVideoStreams")));O.push(Uo(C,h,"transfer"));return g.r2.all(O)}),3);
case 3:if(!B){l.Ux(4);break}return g.X(l,KNf(K),4);case 4:zNK({videoId:K,RU:h,offlineModeType:(Q=D)==null?void 0:Q.offlineModeType}),g.VK(l)}})},pDK=function(A,L,B,f){if(!A.action.entityKey)throw Error("entityKey is missing.");
var K=g.Pv(A.action.entityKey);K={entityType:K.ED,entityId:K.entityId,offlineOrchestrationActionType:A.action.actionType,orchestrationAction:{orchestrationActionId:A.actionId}};L&&(K.offlineOrchestrationActionResult=L.status,K.isRetryable=B?!1:L.N,L.V&&(K.offlineOrchestrationFailureReason=wDX(L.V,K.isRetryable)));var V,J;if((V=A.action.actionMetadata)==null?0:(J=V.offlineLoggingData)==null?0:J.offlineModeType)K.offlineModeType=A.action.actionMetadata.offlineLoggingData.offlineModeType;f&&(K.additionalOrchestrationActions=
f.map(function(R){return{orchestrationActionId:R.actionId}}));
return K},wDX=function(A,L){return A!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||L?A==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&L?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":A:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},yUK=function(A,L){var B={offlineOrchestrationContext:pDK(A)};
L=itB(L,B);$nK(CH9(),L,A.rootActionId)},j$B=function(A,L,B,f){f=f===void 0?[]:f;
L={offlineOrchestrationContext:pDK(A,L,B,f)};L=itB(3,L);$nK(CH9(),L,A.rootActionId)},gAX=function(){this.actions=[]},G9d=function(A,L){L=g.m(L);
for(var B=L.next();!B.done;B=L.next())B=B.value,yUK(B,1),A.actions.push(B);A.actions.sort(A.N)},rUB=function(A,L){if(L)for(var B=0;B<A.actions.length;B++)if(L==="!*$_ALL_ENTITIES_!*$"&&A.actions[B].actionId!==L||L!=="!*$_ALL_ENTITIES_!*$"&&A.actions[B].rootActionId===L&&A.actions[B].actionId!==L)A.actions.splice(B,1),B--},s$W=function(A,L){A=g.m(A.actions);
for(var B=A.next();!B.done;B=A.next())if(B.value.actionId===L)return!0;return!1},XG=function(A,L,B,f,K){g.Y.call(this);
var V=this;this.W=A;this.Vj=L;this.Wn=B;this.X=f;this.L=K;this.N=new gAX;this.T=new g.Pa;this.V=new g.aa(function(){V.retry()});
this.G=NaN;this.D=!1;this.GV={j5p:function(){return V.N},
bB:function(){return V.T},
rqn:function(){return V.V},
retry:function(){return V.retry()}};
g.W(this,this.V);this.yj=this.W.observe(this.qp.bind(this))},b8K=function(A,L,B,f,K){var V;
return g.c(function(J){if(J.N==1)return V=new XG(A,L,B,f,K),g.X(J,H8I(V),2);hq9(V);return J.return(V)})},hq9=function(A){var L=A.N.actions[0];
return A.U?((L==null?void 0:L.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&A.U[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(A.D=!0),Promise.resolve()):taO(A)},taO=function(A){var L,B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q;
return g.c(function(l){switch(l.N){case 1:if(A.U)throw Error("Already processing an action");if(A.TL())return l.return();L=A.N.actions.shift();eNf(A.Wn,!L);if(L===void 0)return l.return();L.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&L.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&rUB(A.N,L.actionId);B="";L.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&L.rootActionId===L.actionId&&(B=L.actionId);f=[L];A.U=f;if(K=A.Vj[L.entityType]){l.Ux(2);break}A.U=
void 0;return g.X(l,taO(A),3);case 3:return l.return();case 2:V=g.m(f);for(J=V.next();!J.done;J=V.next())R=J.value,yUK(R,2);g.S5(l,4,5);return g.X(l,vZw(K,f.map(function(C){return C.action})),7);
case 7:Z=l.W,N=g.m(f),F=N.next();case 8:if(F.done){l.Ux(10);break}D=F.value;I=Z.get(D.action);return g.X(l,k9f(A,D,I),9);case 9:F=N.next();l.Ux(8);break;case 10:rUB(A.N,B);case 5:g.F9(l);A.U=void 0;g.DR(l,6);break;case 4:return d=g.NX(l),LB("Orchestration error",d),g.S5(l,12),g.X(l,TbX(A,f),14);case 14:g.ZR(l,5);break;case 12:w=g.NX(l);LB("Orchestration retry error",w);r=g.m(f);for(h=r.next();!h.done;h=r.next())Q=h.value,Q.retryScheduleIndex<3&&G9d(A.N,[Q]);l.Ux(5);break;case 6:return g.X(l,taO(A),
0)}})},k9f=function(A,L,B){var f,K,V,J,R,Z,N,F,D,I,d,w;
return g.c(function(r){switch(r.N){case 1:f=L.retryScheduleIndex+2===3;if(B.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){r.Ux(2);break}if(B.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){r.Ux(0);break}j$B(L,B,f);if(B.N&&L.retryScheduleIndex+1<3)return g.X(r,TbX(A,[L]),0);V=((K=B)==null?0:K.W)?B.W:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";J={entityKey:L.action.entityKey,failureReason:V};R=void 0;g.SK(A.L)?R="mainVideoDownloadStateEntity":g.cH(A.L)&&(R="musicTrackDownloadMetadataEntity");
if(!R||!B.downloadState){r.Ux(7);break}Z=g.Pv(L.action.entityKey).entityId;return g.X(r,N6(Z,R,A.W,B.downloadState),7);case 7:Bn(A.X,J);if(B.downloadState==="DOWNLOAD_STATE_FAILED"&&A.L.J("html5_auto_retry_failed_pde_actions")){r.Ux(0);break}LB("Orchestration result is not retryable, deleting action");return g.X(r,dnt(A.W,pB(L).key),0);case 2:N=void 0;try{N=(F=B.U)==null?void 0:F.map(function(h){return A.createAction(h,L)})}catch(h){return j$B(L,B,f),D={entityKey:L.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Bn(A.X,D),LB("Orchestration subactions creation error",h),r.return()}j$B(L,B,f,N);if(!N){r.Ux(12);break}I=N.map(function(h){return pB(h)});
d=0;case 13:if(!(d<N.length)||A.D){r.Ux(15);break}return g.X(r,Px(A.W,{mode:"readwrite",Ev:!0},function(h){var Q=[];Q.push(fkd(h,I.slice(d,d+10),"offlineOrchestrationActionWrapperEntity"));return g.r2.all(Q)}),16);
case 16:d+=10;r.Ux(13);break;case 15:if(A.D)return A.D=!1,r.return();case 12:return w=pB(L),g.X(r,dnt(A.W,w.key),17);case 17:yUK(L,4),g.VK(r)}})},CX9=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d;
return g.c(function(w){B=[];f=Infinity;K=4E3;V=g.m(L);for(J=V.next();!J.done;J=V.next())R=J.value,Z=Number(R.enqueueTimeSec),N=lm5(Z),F=R.retryScheduleIndex,D=F!=null&&F>0,N>0&&D?(f=Math.min(f,Z),K=Math.min(N,K)):B.push(R);isFinite(f)&&(!A.V.isActive()||f<A.G)&&(A.G=f,A.V.start(K));A.T.Dr()||(I=B.length,B=B.filter(function(r){var h;r=((h=r.actionProto)==null?void 0:h.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!mBK.includes(r)}),d=B.length<I,!A.V.isActive()&&d&&A.V.start(1));
B.length>0&&Q$W(A,B);return g.X(w,hq9(A),0)})},$Bf=function(A){var L,B,f,K,V,J,R;
return g.c(function(Z){if(Z.N==1)return g.X(Z,i85(A),2);L=Z.W;B=[];f=g.m(L);for(K=f.next();!K.done;K=f.next())V=K.value,J=g.Pv(V.key),R=J.entityId,s$W(A.N,R)||B.push(V);return g.X(Z,CX9(A,B),0)})},lm5=function(A){A=A*1E3-Date.now();
return A>4E3?4E3:A},TbX=function(A,L){var B,f,K;
return g.c(function(V){B=g.m(L);for(f=B.next();!f.done;f=B.next()){K=f.value;var J=void 0,R=void 0,Z=((R=K.action)==null?void 0:(J=R.actionMetadata)==null?void 0:J.retryScheduleIntervalsInSeconds)||[1,2,4];J=1;K.retryScheduleIndex<Z.length&&(J=Z[K.retryScheduleIndex]);K.N=J*1E3+Date.now();K.retryScheduleIndex++}return g.X(V,XDX(A,L),0)})},H8I=function(A){var L;
return g.c(function(B){if(B.N==1)return g.X(B,n7(A.W,"offlineOrchestrationActionWrapperEntity"),2);L=B.W;return g.X(B,CX9(A,L),0)})},Q$W=function(A,L){L.length!==0&&L.forEach(function(B){B=wB(B);
B.retryScheduleIndex<3&&G9d(A.N,[B])})},i85=function(A,L){var B;
return g.c(function(f){if(f.N==1)return g.X(f,n7(A.W,"offlineOrchestrationActionWrapperEntity",L),2);B=f.W;return f.return(B.filter(Gz9))})},XDX=function(A,L){if(L.length===0)return Promise.resolve([]);
L=L.map(function(B){return pB(B)});
return Dnw(A.W,L)},O8w=function(A){this.rT=A;
this.N=void 0},EAO=function(A,L){var B,f,K,V;
return g.c(function(J){B=L.videoId;f=!0;if(L.captionTracks.length)K=xhK(L),A.N=new g.I_(A.rT,L,K);else if(L.zV)V=g.OSD(L),A.N=new g.pj(A.rT,L.zV,B,V,L.cR,L.eventId),f=L.cR;else return J.return();return J.return(new Promise(function(R){var Z;(Z=A.N)==null||Z.wK({bW:function(){return g.c(function(N){if(N.N==1)return g.X(N,A.bW(B,f),2);R();g.VK(N)})},
FY:function(){}})}))})},cUK=function(A){var L;
return g.c(function(B){if(B.N==1)return g.X(B,btt(A),2);L=B.W;return B.return(!!L&&L.length>0)})},O8=function(A){g.Y.call(this);
this.N=A;this.W=this.N.observe(this.V.bind(this))},Mad=function(A,L){var B,f,K,V,J,R,Z;
return g.c(function(N){switch(N.N){case 1:if(L.length===0)return N.return([]);B=L.map(function(F){return g.xv(F,"transfer")});
return g.X(N,n7(A.N,"transfer",B),2);case 2:f=N.W;K=f.filter(Gz9).map(function(F){return g.Pv(F.key).entityId});
V=L.filter(function(F){return K.indexOf(F)===-1});
if(V.length===0)return N.return([]);J=g.m(V);R=J.next();case 3:if(R.done){N.Ux(5);break}Z=R.value;return g.X(N,KNf(Z),4);case 4:R=J.next();N.Ux(3);break;case 5:return N.return(V)}})},WN5=function(A,L,B,f,K,V){var J,R,Z;
return g.c(function(N){J="STREAM_TYPE_UNKNOWN";B.video&&B.audio?(J="STREAM_TYPE_AUDIO_AND_VIDEO",LB("unexpected stream type")):B.video&&!B.audio?J="STREAM_TYPE_VIDEO":!B.video&&B.audio&&(J="STREAM_TYPE_AUDIO");R=g.xv(L,"offlineVideoStreams");Z={numBytesDownloaded:K.toFixed(),numTotalBytes:V.toFixed(),streamType:J,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(f),itag:J==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(B.itag):void 0};return g.X(N,Px(A,{mode:"readwrite",Ev:!0},
function(F){var D=cx(F,R,"offlineVideoStreams"),I=cx(F,g.xv(L,"transfer"),"transfer");return g.r2.all([D,I]).then(function(d){d=g.m(d);var w=d.next().value;d=d.next().value;if(!d)return Wx(F,R).then(function(){});
var r=YEK(w);w=UBK(w,f,Z,R);var h=Uo(F,w,"offlineVideoStreams");YEK(w)>r&&(d.lastProgressTimeMs=Date.now().toString());r=[h];d.offlineVideoStreams||(d.offlineVideoStreams=[]);d.offlineVideoStreams.indexOf(R)===-1&&(d.offlineVideoStreams.push(R),r.push(Uo(F,d,"transfer")));return g.r2.all(r)})}),0)})},vAK=function(A,L){var B,f,K,V,J;
return g.c(function(R){if(R.N==1)return B=g.xv(L,"offlineVideoStreams"),g.X(R,eJ(A,B,"offlineVideoStreams"),2);f=R.W;if(!f||!f.streamsProgress)return R.return();K=g.m(f.streamsProgress);for(V=K.next();!V.done;V=K.next())J=V.value,J.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",J.numTotalBytes!==J.numBytesDownloaded&&(J.numBytesDownloaded=J.numTotalBytes);return g.X(R,xB(A,f,"offlineVideoStreams"),0)})},UBK=function(A,L,B,f){if(A&&A.streamsProgress){f=A;
a:{L=L.itag+";"+L.xtags;for(var K=A.streamsProgress,V=0;V<K.length;V++){var J=JSON.parse(K[V].formatStreamBytes);if(J.itag+";"+J.xtags===L){K[V]=B;B=K;break a}}K.push(B);B=K}f.streamsProgress=B}else A={key:f,streamsProgress:[B]};return A},YEK=function(A){if(A==null?0:A.streamsProgress){var L=0;
A=A.streamsProgress;for(var B=0;B<A.length;B++){var f=A[B];isNaN(Number(f.numBytesDownloaded))?LB("stream progress bytes number invalid"):L+=Number(f.numBytesDownloaded)}return L}return 0},qEB=function(A,L,B,f){g.Y.call(this);
var K=this;this.W=A;this.api=L;this.Ex=B;this.qp=f;this.T=new g.Pa;this.U=new g.aa(function(){K.N&&K.N.transferState==="TRANSFER_STATE_TRANSFERRING"&&K.T.Dr()&&((K.N.transferRetryCount||0)<3?$J(K.X,K.D,!1,!1):iK(K.X,K.D.videoDetails.videoId),K.ZA("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Wn=this.wT=0;this.yj=this.G=!1;this.Cr=g.Am(this.api.K().experiments,"html5_transfer_processing_logs_interval");this.Ys=new g.dN(this);this.GV={uC4:function(){return K.U},
F5F:function(){return K.qp},
bB:function(){return K.T}};
this.Vj=this.W.observe(this.Bi.bind(this));this.X=new fmB(L,this);this.sx=new O8w(L);this.ZM=new O8(this.W);this.S4=this.T.listen("publicytnetworkstatus-online",this.AG.bind(this));this.JF=this.T.listen("publicytnetworkstatus-offline",this.Vo4.bind(this));this.yj=this.api.K().J("html5_less_transfer_processing_logs");g.W(this,this.Ys);this.Ys.Y(L,"offlinetransferpause",this.mFT);if(g.SK(this.api.K()))this.V="mainVideoDownloadStateEntity";else if(g.cH(this.api.K())||g.Z_(this.api.K()))this.V="musicTrackDownloadMetadataEntity"},
PXd=function(A){return g.c(function(L){if(L.N==1)L=g.X(L,Ht5(),2);
else{var B=A.ZM;var f=g.WN();f=Object.keys(f);B=Mad(B,f);L=g.X(L,B,0)}return L})},cn=function(A,L){L=L===void 0?!1:L;
var B;return g.c(function(f){if(f.N==1){if(A.N)throw Error("Already downloading a video");A.Wn=0;A.G=!1;return g.X(f,xB9(A),2)}return f.N!=4?(B=f.W,net(A.Ex,!B),B&&A.T.Dr()?L?g.X(f,new Promise(function(K){g.gW(K,1E3)}),4):f.Ux(4):(!B&&A.N&&E8(A),f.Ux(0))):g.X(f,eqR(A,B),0)})},nAB=function(A){return g.c(function(L){if(L.N==1)return A.D?g.X(L,iK(A.X,A.D.videoDetails.videoId),3):L.Ux(0);
E8(A);g.VK(L)})},zqd=function(A,L){var B,f,K;
return g.c(function(V){switch(V.N){case 1:return g.S5(V,2),(B=!!L.captionTracks.length||!!L.zV)?g.X(V,cUK(L.videoId),4):V.return();case 4:return(f=V.W)?V.return():g.X(V,EAO(A.sx,L),5);case 5:g.ZR(V,0);break;case 2:K=g.NX(V),LB("Caption downloading error",K,L.cotn),g.VK(V)}})},eqR=function(A,L){var B,f,K,V,J,R;
return g.c(function(Z){switch(Z.N){case 1:if(A.G)return Z.return();A.G=!0;A.N=L;B=g.Pv(A.N.key);f=B.entityId;K=void 0;if(A.N.transferState==="TRANSFER_STATE_TRANSFERRING")return g.X(Z,M6(A,f),7);if(A.N.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||A.N.transferRetryCount||A.N.hasLoggedFirstStarted){Z.Ux(3);break}return g.X(Z,M6(A,f),5);case 5:return K=Z.W,A.N.hasLoggedFirstStarted=!0,g.X(Z,utW(A),6);case 6:uxO({videoId:f,RU:A.N,offlineModeType:K},void 0,void 0,!0);Z.Ux(3);break;case 7:K=Z.W,
VZ({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:f,RU:A.N,offlineModeType:K});case 3:return g.X(Z,amI(A),8);case 8:return V=null,g.S5(Z,9),g.X(Z,Aut(A,L),11);case 11:V=Z.W;A.D=V;g.ZR(Z,10);break;case 9:return J=g.NX(Z),LB("error getting player response",J,L.cotn),g.X(Z,A.ZA("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return Z.return();case 10:return R=KQW(A.api.K(),L.cotn,V),g.X(Z,zqd(A,R),13);case 13:return g.X(Z,VaB(R.videoId),
14);case 14:R.e6=Z.W;var N=A.X,F=R,D=L.maximumDownloadQuality;F.getPlayerResponse();g.qg(F.videoId,2);N.V=2;N.W=!1;var I;(I=N.player)==null||I.dispose();N.player=N.api.Jp(F);F={};N.player.tA((F.localmediachange=N.FG,F.signatureexpired=N.UM,F.statechange=N.Xy4,F),N);N.J("html5_generate_content_po_token")&&N.player.HG();D=N.r8(D);N.player.OO(g.XX(D,D,!0,"m"),!1);N.player.dK(!1);A.U.start(108E5);g.VK(Z)}})},xB9=function(A){var L,B;
return g.c(function(f){if(f.N==1)return g.X(f,n7(A.W,"transfer"),2);L=f.W;B=L.filter(L7f).sort(oM9);return B.length===0?f.return():f.return(B[0])})},amI=function(A){var L,B,f;
return g.c(function(K){if(K.N==1){if(!A.N)return YJ(A,"onTransferStart"),K.return();A.U.start(108E5);return g.X(K,U8(A,"TRANSFER_STATE_TRANSFERRING"),2)}L=A.N;return(f=((B=L)==null?0:B.key)?g.Pv(L.key).entityId:"")&&A.V?g.X(K,N6(f,A.V,A.W,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):K.Ux(0)})},SEd=function(A){var L,B,f,K;
g.c(function(V){switch(V.N){case 1:if(!A.N){YJ(A,"onTransferPausedByUser");V.Ux(2);break}L=A.N;A.U.stop();return g.X(V,U8(A,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:f=((B=L)==null?0:B.key)?g.Pv(L.key).entityId:"";if(!f||!A.V){V.Ux(4);break}return g.X(V,N6(f,A.V,A.W,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.X(V,M6(A,f),6);case 6:K=V.W,A9t({videoId:f,RU:L,offlineModeType:K});case 2:E8(A),cn(A),g.VK(V)}})},RqW=function(A){var L,B,f;
g.c(function(K){if(K.N==1){if(!A.N)return YJ(A,"onTransferPausedByNetwork"),K.return();A.U.stop();return g.X(K,U8(A,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(K.N!=3)return L=A.N,(f=((B=L)==null?0:B.key)?g.Pv(L.key).entityId:"")&&A.V?g.X(K,N6(f,A.V,A.W,"DOWNLOAD_STATE_PAUSED"),3):K.Ux(3);E8(A);g.VK(K)})},Bsf=function(A){var L,B,f,K,V;
g.c(function(J){switch(J.N){case 1:if(!A.N)return YJ(A,"onTransferComplete"),J.return();L=A.N;A.U.stop();if(!L||!A.D){J.Ux(2);break}B=KQW(A.api.K(),L.cotn,A.D);return g.X(J,zqd(A,B),2);case 2:return g.X(J,U8(A,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:K=((f=L)==null?0:f.key)?g.Pv(L.key).entityId:"";if(!K||!A.V){J.Ux(5);break}return g.X(J,N6(K,A.V,A.W,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.X(J,vAK(A.W,K),7);case 7:return g.X(J,M6(A,K),8);case 8:V=J.W,VZ({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:K,RU:L,offlineModeType:V}),E8(A),cn(A),g.VK(J)}})},fHK=function(A,L,B){var f,K;
g.c(function(V){switch(V.N){case 1:if(!A.N)return YJ(A,"onTransferProgress: "+L),V.return();if(A.N.transferState==="TRANSFER_STATE_TRANSFERRING"){V.Ux(2);break}return g.X(V,amI(A),2);case 2:f=Date.now();if(!(f-A.wT>1E3)){V.Ux(4);break}A.wT=f;return g.X(V,WN5(A.W,B.videoId,B.W,B.UF,B.bytesDownloaded,B.N),5);case 5:if(A.yj&&!(A.yj&&f-A.Wn>A.Cr)){V.Ux(4);break}A.Wn=f;return g.X(V,M6(A,L),7);case 7:K=V.W,uxO({videoId:L,RU:A.N,offlineModeType:K},B.bytesDownloaded,B.N);case 4:A.U.start(108E5),g.VK(V)}})},
K7X=function(A){var L=(A.N.transferRetryCount||0)<3;
L&&(A=A.N,A.transferRetryCount=(A.transferRetryCount||0)+1);return L},VAt=function(A,L){L=L===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":L;
var B,f,K,V;return g.c(function(J){if(J.N==1)return A.N||YJ(A,"setTransferToFailed: "+L),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L==="TRANSFER_FAILURE_REASON_NETWORK"?B="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":L==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.X(J,U8(A,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",L),2);if(J.N!=3)return Bn(A.qp,{entityKey:(f=A.N)==null?void 0:f.key,failureReason:B}),
K=A.N?g.Pv(A.N.key).entityId:"",g.X(J,M6(A,K),3);V=J.W;var R={videoId:K,RU:A.N,offlineModeType:V},Z=L,N={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};Z&&(N.transferFailureReason=Z,N.failureReason=LQW(Z));VZ(N,R);g.VK(J)})},U8=function(A,L,B,f){var K;
return g.c(function(V){if(V.N==1){if(!A.N)return YJ(A,"saveTransferState: "+L),V.return();A.N.transferState=L;A.N.failureReason=f;g.S5(V,2);return g.X(V,utW(A,function(J){return B?Mk(J,"offlineVideoStreams",A.N.offlineVideoStreams).then(function(R){for(var Z=g.m(R),N=Z.next();!N.done;N=Z.next())if((N=N.value)&&N.streamsProgress){N=g.m(N.streamsProgress);for(var F=N.next();!F.done;F=N.next())F.value.streamState=B}return fkd(J,R.filter(function(D){return!!D}),"offlineVideoStreams")}):g.r2.resolve(void 0)}),
4)}if(V.N!=2)return g.ZR(V,0);
K=g.NX(V);return K instanceof g.Il&&K.type==="QUOTA_EXCEEDED"?g.X(V,A.ZA("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):V.Ux(0)})},utW=function(A,L){var B;
return g.c(function(f){if(!A.N)return f.return();B=A.N;return g.X(f,Px(A.W,{mode:"readwrite",Ev:!0},function(K){var V=[Uo(K,B,"transfer")];L&&V.push(L(K));return g.r2.all(V)}),0)})},E8=function(A){A.N=void 0;
A.D=void 0;A.U.stop()},Aut=function(A,L){var B,f,K,V,J;
return g.c(function(R){if(R.N==1)return B=g.Pv(L.key),f=B.entityId,K=g.xv(f,"playbackData"),g.X(R,eJ(A.W,K,"playbackData"),2);V=R.W;if((J=V)==null?0:J.playerResponseJson)return R.return(JSON.parse(V.playerResponseJson));throw Error("No PlayerResponse found");})},YJ=function(A,L){A.api.Hn("woffle",{mcte:L});
LB("missing current transfer entity.")},M6=function(A,L){var B,f,K;
return g.c(function(V){if(V.N==1)return g.X(V,eJ(A.W,g.xv(L,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);B=V.W;return V.return((K=(f=B)==null?void 0:f.offlineModeType)!=null?K:void 0)})},L7f=function(A){return JuB[A.transferState]!==void 0},oM9=function(A,L){var B=JuB[A.transferState],f=JuB[L.transferState];
return B!==f?B-f:Number(A.enqueuedTimestampMs)-Number(L.enqueuedTimestampMs)},Wn=function(A,L){var B=this;
this.L=A;this.api=L;this.T=new g.Pa;this.D=new g.IQ;this.GV={II:function(){return B.V.GV.II()},
bB:function(){return B.T},
U2p:function(){return B.V},
vM:function(){return B.vM()},
i$:function(){return B.i$()},
nM:function(){return B.nM()},
pN:function(){return B.pN()},
CN:function(){return B.CN()},
Pm:function(f){return B.Pm(f)}};
this.V=new q3w(function(){return Skf(B)},function(){B.nM()},this.api.WI(),this.api.J.bind(this.api));
this.N=new oi(this.api);PHK(this.V)},Skf=function(A){return g.c(function(L){A.api.Kr("onOrchestrationBecameLeader");
return g.X(L,A.i$(),0)})},Z2d=function(A){var L,B;
return g.c(function(f){if(f.N==1)return g.X(f,zq(),2);if(f.N!=3){L=f.W;if(!L)return LB("PES is undefined"),f.return();A.W=new qEB(L,A.api,A.V,A.N);B=A.BN(L);return g.X(f,b8K(L,B,A.V,A.N,A.L),3)}A.X=f.W;return g.X(f,Rvw(A),0)})},Rvw=function(A){var L;
return g.c(function(B){switch(B.N){case 1:if(!A.W)return LB("transferManager is undefined"),B.return();if(A.W.N){B.Ux(2);break}return g.X(B,cn(A.W),2);case 2:if(!A.L.J("woffle_enable_main_downloads_library")){B.Ux(4);break}return g.X(B,A.ZS(),4);case 4:if(!A.L.J("html5_offline_playback_position_sync")){B.Ux(6);break}return g.X(B,A.Sp(),7);case 7:return g.X(B,A.Pm(864E5),6);case 6:return g.X(B,A.refreshAllStaleEntities(43200,!0),9);case 9:return g.X(B,A.Dw(),10);case 10:if(!A.L.J("html5_retry_downloads_for_expiration")){B.Ux(11);
break}return g.X(B,A.CN(),11);case 11:return A.G=g.Gc(function(){A.refreshAllStaleEntities(43200,!0);A.Dw()},9E5),g.AR(g.ol(),function(){return A.pN()}),g.X(B,zq(),13);
case 13:return L=B.W,g.X(B,veX(L),14);case 14:xnK(A.V),g.VK(B)}})},NsK=function(){var A,L,B,f,K,V;
return g.c(function(J){switch(J.N){case 1:return g.X(J,zq(),2);case 2:A=J.W;if(!A)return J.return([]);L=Date.now()/1E3;return g.X(J,n7(A,"offlineVideoPolicy"),3);case 3:B=J.W,f=g.m(B),K=f.next();case 4:if(K.done){J.Ux(6);break}V=K.value;if(!(V.expirationTimestamp&&Number(V.expirationTimestamp)<L)){J.Ux(5);break}V.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";V.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.X(J,xB(A,V,"offlineVideoPolicy"),5);
case 5:K=f.next();J.Ux(4);break;case 6:return J.return(B.map(function(R){return R.key}))}})},vn=function(A,L,B,f,K){var V,J,R;
return g.c(function(Z){if(Z.N==1)return g.X(Z,zq(),2);V=Z.W;if(!V)return Z.return([]);J=L.map(function(N){var F=g.xv(N,B);F={actionType:f,entityKey:F,actionMetadata:Object.assign({},VWB(),K)};f!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(F.actionMetadata.priority=0);N=new Ii(B,N,F);return pB(N)});
R=Dnw(V,J);PHK(A.V);return Z.return(R)})},F7X=function(A,L,B,f){var K,V,J,R,Z,N,F,D;
return g.c(function(I){switch(I.N){case 1:K=[],V=g.m(L),J=V.next();case 2:if(J.done){I.Ux(4);break}R=J.value;if(R.upToDate||B&&!R.shouldAutoSyncMetadata||!R.playlistId){I.Ux(3);break}Z={};switch(f){case "mainPlaylistEntity":N={nextAutoRefreshIntervalSeconds:R.checkInSeconds,autoSync:B};Z={mainPlaylistEntityActionMetadata:N};break;case "musicPlaylist":F={autoSync:B},Z={musicPlaylistEntityActionMetadata:F}}return g.X(I,vn(A,[R.playlistId],f,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z),6);case 6:(D=
I.W)&&K.push.apply(K,g.x7(D));case 3:J=V.next();I.Ux(2);break;case 4:return I.return(K)}})},DWK=function(A,L){var B;
return g.c(function(f){return L.length?(B=VWB(),g.cb(B,QZ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),A.api.Hn("qrd",{v:L.length}),f.return(vn(A,L,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",B))):f.return([])})},dWw=function(A,L,B){this.N=A;
this.L=L;this.V=B},pcI=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l;
return g.c(function(C){switch(C.N){case 1:return B=JH(L),f=g.Pv(L.entityKey),K=f.entityId,V=[],g.S5(C,2),g.X(C,IHf(A,K),4);case 4:V=C.W;if(!(A.L.J("woffle_enable_main_downloads_library")&&((J=V)==null?0:J.length))){C.Ux(5);break}return g.X(C,jxt(A.N,[L.entityKey]),5);case 5:g.ZR(C,3);break;case 2:return R=g.NX(C),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.Il&&R.type==="QUOTA_EXCEEDED"?(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):LB("Playlist add error"),C.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,Z,N));case 3:F=[];if(!A.L.J("html5_offline_prevent_redownload_downloaded_video")){C.Ux(7);break}return g.X(C,faf(A.N,"mainVideoEntity",V),8);case 8:V=C.W;case 7:if((D=V)==null?0:D.length)for(I=g.m(V),d=I.next();!d.done;d=I.next())if(w=d.value,r=w.offlineVideoData,h=void 0,(h=r)==null?0:h.videoId)Q=void 0,l=Number(((Q=L.actionMetadata)==null?void 0:Q.priority)||
0)+1,F.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",r.videoId,"mainVideoEntity",l,q6,wcO(L,r,K)));return C.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,F))}})},jQK=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw,Xk,e5,mt,T,aO,YW,R0,TK,b,Lw,ro,SZ,xg,R8,a0,oO,tO,k,H,t,E,e,SE,z,P,M,mv,Qe,ye,T8,ff,t1,Yg,eZ,nf,lL,W4,Cw,sd,Y7,E6,Hw;
return g.c(function(AO){switch(AO.N){case 1:return B=JH(L),f=L.entityKey,K=g.Pv(f).entityId,V=[],J=!1,K==="!*$_ALL_ENTITIES_!*$"?(J=!0,g.X(AO,n7(A.N,"mainPlaylistEntity"),5)):g.X(AO,eJ(A.N,f,"mainPlaylistEntity"),4);case 4:(R=AO.W)&&V.push(R);AO.Ux(3);break;case 5:V=AO.W;case 3:if((Z=V)==null||!Z.length)return AO.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));N=g.y(L.actionMetadata,yuf);D=(F=N)==null?void 0:F.nextAutoRefreshIntervalSeconds;d=(I=N)==null?void 0:I.autoSync;w=[];h=r=
!0;Q=!1;if(!J&&d===!1){AO.Ux(6);break}g.S5(AO,7);return g.X(AO,CmX(0,!!d,!0,V),9);case 9:w=AO.W;g.ZR(AO,8);break;case 7:l=g.NX(AO);if(!(l instanceof Error&&l.message==="No data")){l instanceof Error&&l.message==="Empty response body"&&LB(l.message);AO.Ux(8);break}return K==="!*$_ALL_ENTITIES_!*$"?g.X(AO,DOX(A.N,L,A.V,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.X(AO,Nmf(K,A.N,L,A.V),8);case 8:if(!w.length||!J&&w[0].playlistId!==K)return AO.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B));case 6:if(J){C=[];O=g.m(w);for(v=O.next();!v.done;v=O.next())U=v.value,U.upToDate||d&&!U.shouldAutoSyncMetadata||!U.playlistId||(a={nextAutoRefreshIntervalSeconds:U.checkInSeconds,autoSync:d},C.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U.playlistId,"mainPlaylistEntity",0,q6,{mainPlaylistEntityActionMetadata:a})));return AO.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,C))}w.length&&(o0=w[0],Q=!!o0.upToDate,d&&(r=(B6=o0.shouldAutoSyncMetadata)!=null?B6:!0,h=(Ve=o0.shouldAutoSyncVideos)!=
null?Ve:!0,o0.checkInSeconds&&(D=o0.checkInSeconds)));if(Q||!r)return AO.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));DS=[];fw=V[0];if(!fw.downloadState){ry=void 0;AO.Ux(15);break}return g.X(AO,eJ(A.N,fw.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:ry=AO.W;case 15:return uL=ry,MC=((Jf=uL)==null?0:Jf.addedTimestampMillis)?String(uL.addedTimestampMillis):void 0,g.S5(AO,17),g.X(AO,IHf(A,K,MC,D),19);case 19:DS=AO.W;g.ZR(AO,18);break;case 17:nw=g.NX(AO);if(!(nw instanceof
Error&&nw.message==="No data for playlist")){if(nw instanceof Error&&nw.message==="Empty response body for playlist")LB(nw.message);else return Xk="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",nw instanceof g.Il&&nw.type==="QUOTA_EXCEEDED"&&(Xk="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),AO.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,Xk,e5));
AO.Ux(18);break}return g.X(AO,Nmf(K,A.N,L,A.V),18);case 18:if(!h)return AO.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));mt=[];T=new Map;if((aO=DS)==null?0:aO.length)for(YW=g.m(DS),R0=YW.next();!R0.done;R0=YW.next())TK=R0.value,b=TK.offlineVideoData,Lw=void 0,((Lw=b)==null?0:Lw.videoId)&&T.set(b.videoId,b);ro=new Map;SZ=[];if((xg=fw)==null?0:(R8=xg.videos)==null?0:R8.length)for(a0=g.m(fw.videos),oO=a0.next();!oO.done;oO=a0.next())if(tO=oO.value,k=JSON.parse(g.Pv(tO).entityId),H=
k.videoId)T.has(H)?(ro.set(H,T.get(H)),T.delete(H)):SZ.push(H);E=Number(((t=L.actionMetadata)==null?void 0:t.priority)||0)+1;e=g.m(T.entries());for(SE=e.next();!SE.done;SE=e.next())z=SE.value,P=g.m(z),M=P.next().value,mv=P.next().value,Qe=M,ye=mv,mt.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Qe,"mainVideoEntity",E,q6,wcO(L,ye,K)));T8=g.m(ro.entries());for(ff=T8.next();!ff.done;ff=T8.next())t1=ff.value,Yg=g.m(t1),eZ=Yg.next().value,nf=Yg.next().value,lL=eZ,W4=nf,mt.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
lL,"mainVideoEntity",E,q6,wcO(L,W4,K)));Cw=g.m(SZ);for(sd=Cw.next();!sd.done;sd=Cw.next())Y7=sd.value,E6={playlistId:K},Hw={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:E6},mt.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Y7,"mainVideoEntity",0,q6,Hw));return AO.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,mt))}})},gMB=function(A,L){var B,f,K,V;
return g.c(function(J){switch(J.N){case 1:return B=JH(L),g.S5(J,2),f=g.Pv(L.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.X(J,DOX(A.N,L,A.V,(K=L.actionMetadata)==null?void 0:(V=K.offlineLoggingData)==null?void 0:V.offlineDeleteReason),5):g.X(J,Nmf(f,A.N,L,A.V),6);case 6:if(!A.L.J("woffle_enable_main_downloads_library")){J.Ux(5);break}return g.X(J,gZI(A.N,L.entityKey),5);case 5:g.ZR(J,3);break;case 2:return g.NX(J),J.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B))}})},IHf=function(A,L,B,f){var K,V,J,R,Z,N,F;
return g.c(function(D){switch(D.N){case 1:return g.X(D,mOf([L]),2);case 2:return K=D.W,g.X(D,GX5(A,K[0],B,f),3);case 3:return V=D.W,J=V.mainPlaylistEntity,R=V.MoF,N=Rj5(J,(Z=R)==null?void 0:Z.avatar),g.S5(D,4),g.X(D,jI(N),6);case 6:g.ZR(D,5);break;case 4:F=g.NX(D),F instanceof Error&&F.message==="Failed to fetch"&&LB(F.message);case 5:return D.return(K[0].videos)}})},GX5=function(A,L,B,f){var K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O;
return g.c(function(v){switch(v.N){case 1:K=Date.now().toString();B||(B=K);V=L.videos;J=L.playlistId;R=[];Z=[];if(V)for(N=g.m(V),F=N.next();!F.done;F=N.next()){D=F.value;I=D.offlineVideoData;if(!I||!I.videoId)throw LB("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");d=I.videoId;w={videoId:d,playlistId:J};r={id:g.xv(JSON.stringify(w),"mainPlaylistVideoEntity"),video:g.xv(d,"mainVideoEntity")};R.push(r);Z.push(r.id)}Q={key:g.xv(J,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:B,lastSyncedTimestampMillis:K};l={key:g.xv(J,"mainPlaylistEntity"),playlistId:J,videos:Z,title:L.title,thumbnailStyleData:ruX(L),visibility:sQw(L),downloadState:Q.key};L.channel&&(C=L.channel.offlineChannelData,h=H2I(g.xv(J,"ytMainChannelEntity"),C),l.channelOwner=h.id);((O=l)==null?0:O.entityMetadata)?(l.entityMetadata.offlineLastModifiedTimestampSeconds=L.lastModifiedTimestamp,f&&(l.entityMetadata.nextAutoRefreshIntervalSeconds=String(f))):l&&(l.entityMetadata={nextAutoRefreshIntervalSeconds:f?
String(f):void 0,offlineLastModifiedTimestampSeconds:L.lastModifiedTimestamp});g.S5(v,2);return g.X(v,Px(A.N,{mode:"readwrite",Ev:!0},function(U){var a=Uo(U,l,"mainPlaylistEntity"),o0=Uo(U,Q,"mainPlaylistDownloadStateEntity");a=[a,o0];o0=g.m(R);for(var B6=o0.next();!B6.done;B6=o0.next())a.push(Uo(U,B6.value,"mainPlaylistVideoEntity"));h&&a.push(Uo(U,h,"ytMainChannelEntity"));return g.r2.all(a)}),4);
case 4:g.ZR(v,3);break;case 2:throw g.NX(v),LB("PES failure for playlist"),Error("PES failure for playlist");case 3:return v.return({mainPlaylistEntity:l,MoF:h,xbj:R})}})},H2I=function(A,L){return{id:A,
channelId:L.channelId,title:L.title,avatar:L.thumbnail}},ruX=function(A){var L=[],B=A.videos;
B&&B.length>0&&L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:B[0].offlineVideoData.thumbnail}}});if((A=A.additionalMetadadatas)&&A.length>0)for(A=g.m(A),B=A.next();!B.done;B=A.next()){var f=B.value.offlineBundleItemPlaylistData,K=void 0;B=(K=f)==null?void 0:K.style;K=void 0;f={collageThumbnail:{coverThumbnail:(K=f)==null?void 0:K.coverThumbnail}};switch(B){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:f});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:f});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:f});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:f})}}return L},sQw=function(A){switch(A.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},wcO=function(A,L,B){L={offlineVideoData:L,
playlistId:B};if(A=g.y(A.actionMetadata,yuf))L.maximumDownloadQuality=A.maximumDownloadQuality;return{mainVideoEntityActionMetadata:L}},hvI=function(A,L,B){this.N=A;
this.L=L;this.V=B},kXw=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w;
return g.c(function(r){switch(r.N){case 1:return B=JH(L),f=g.Pv(L.entityKey),K=f.entityId,V=g.y(L.actionMetadata,Pn),R=!((J=V)==null?0:J.playlistId),g.S5(r,2),g.X(r,b2f(A,K,void 0,(Z=V)==null?void 0:Z.offlineVideoData,R),4);case 4:g.ZR(r,3);break;case 2:return N=g.NX(r),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.Il&&N.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
r.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,F,D));case 3:I=1;I=Number(((d=L.actionMetadata)==null?void 0:d.priority)||0)+1;var h=(h=g.y(L.actionMetadata,Pn))?{playbackDataActionMetadata:{maximumDownloadQuality:h.maximumDownloadQuality}}:void 0;w=lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K,"playbackData",I,tAO,h);return r.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,[w]))}})},Tsf=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l;
return g.c(function(C){switch(C.N){case 1:return B=JH(L),f=g.Pv(L.entityKey),K=f.entityId,g.X(C,eJ(A.N,L.entityKey,"mainVideoEntity"),2);case 2:V=C.W;if(!V){J=void 0;C.Ux(3);break}return g.X(C,eJ(A.N,V.downloadState,"mainVideoDownloadStateEntity"),4);case 4:J=C.W;case 3:R=J;if(!V||!R)return C.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));g.S5(C,5);return g.X(C,b2f(A,K,R.addedTimestampMillis,(N=g.y(L.actionMetadata,Pn))==null?void 0:N.offlineVideoData),7);case 7:F=1;F=Number(((D=
L.actionMetadata)==null?void 0:D.priority)||0)+1;Z=lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K,"playbackData",F,tAO);g.ZR(C,6);break;case 5:I=g.NX(C);if(!(I instanceof Error&&I.message==="No data")){if(I instanceof Error&&I.message==="Empty response body")LB(I.message);else return d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.Il&&I.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),C.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,d,w));C.Ux(6);break}return g.X(C,rB(A.N,K),9);case 9:r=C.W;h=g.y(L.actionMetadata,Pn);if(l=(Q=h)==null?void 0:Q.playlistId)r.playlistId=l;r.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.X(C,gB(K,A.N,L,A.V,r),6);case 6:return C.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,Z?[Z]:void 0))}})},lH9=function(A,L){var B,f,K,V,J,R,Z,N,F,D;
return g.c(function(I){switch(I.N){case 1:return B=JH(L),g.S5(I,2),f=g.Pv(L.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.X(I,DOX(A.N,L,A.V,(F=L.actionMetadata)==null?void 0:(D=F.offlineLoggingData)==null?void 0:D.offlineDeleteReason),5):g.X(I,rB(A.N,f),6);case 6:K=I.W;V=g.y(L.actionMetadata,Pn);if(R=(J=V)==null?void 0:J.playlistId)K.playlistId=R;K.offlineDeleteReason=(Z=L.actionMetadata)==null?void 0:(N=Z.offlineLoggingData)==null?void 0:N.offlineDeleteReason;return g.X(I,gB(f,A.N,L,A.V,K),7);
case 7:if(!A.L.J("woffle_enable_main_downloads_library")){I.Ux(5);break}return g.X(I,gZI(A.N,L.entityKey),5);case 5:g.ZR(I,3);break;case 2:return g.NX(I),I.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return I.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B))}})},b2f=function(A,L,B,f,K){var V,J,R,Z,N,F;
return g.c(function(D){switch(D.N){case 1:if(V=f){D.Ux(2);break}return g.X(D,lat([L]),3);case 3:J=D.W,V=J[0];case 2:return g.X(D,mWK(A,V,B,K),4);case 4:R=D.W;Z=R.mainVideoEntity;N=R.channelEntity;g.S5(D,5);var I=dB(Z.thumbnail),d=dB(N.avatar);return g.X(D,jI(I.concat(d)),7);case 7:g.ZR(D,0);break;case 5:F=g.NX(D),F instanceof Error&&F.message==="Failed to fetch"&&LB(F.message),g.VK(D)}})},mWK=function(A,L,B,f){var K,V,J,R,Z,N,F,D,I,d,w,r,h;
return g.c(function(Q){switch(Q.N){case 1:B||(B=Date.now().toString());V=(K=L.channel)==null?void 0:K.offlineChannelData;J={id:g.xv(L.videoId,"ytMainChannelEntity"),channelId:V.channelId,title:V.title,avatar:V.thumbnail};R={key:g.xv(L.videoId,"mainVideoDownloadStateEntity"),playbackData:g.xv(L.videoId,"playbackData"),addedTimestampMillis:B,videoDownloadContextEntity:g.xv(L.videoId,"videoDownloadContextEntity")};Z={key:g.xv(L.videoId,"videoPlaybackPositionEntity"),videoId:L.videoId,lastPlaybackPositionSeconds:"0"};
A.L.J("html5_offline_playback_position_sync")&&(N={playbackPosition:Z.key});F=g.xv(L.videoId,"mainVideoEntity");D={key:F,videoId:L.videoId,title:L.title,thumbnail:L.thumbnail,localizedStrings:{viewCount:L.shortViewCountText},userState:N,lengthSeconds:L.lengthSeconds?Number(L.lengthSeconds):void 0,publishedTimestampMillis:L.publishedTimestamp?(Number(L.publishedTimestamp)*1E3).toString():void 0,formattedDescription:L.description,owner:J.id,downloadState:R.key};if(!A.L.J("woffle_enable_main_downloads_library")||
!f){Q.Ux(2);break}return g.X(Q,y9f(A.N,[F]),3);case 3:if(w=Q.W)I=w.mainDownloadsLibraryEntity,d=w.mainDownloadsListEntity;case 2:return h=BmK,r={key:g.xv(L.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.cb(R,h,r),g.X(Q,Px(A.N,{mode:"readwrite",Ev:!0},function(l){var C=Uo(l,J,"ytMainChannelEntity"),O=Uo(l,R,"mainVideoDownloadStateEntity"),v=Uo(l,D,"mainVideoEntity");C=[C,O,v];A.L.J("html5_offline_playback_position_sync")&&(O=Uo(l,Z,"videoPlaybackPositionEntity"),
C.push(O));I&&(O=Uo(l,I,"mainDownloadsLibraryEntity"),C.push(O));d&&(O=Uo(l,d,"mainDownloadsListEntity"),C.push(O));r&&(l=Uo(l,r,"downloadStatusEntity"),C.push(l));return g.r2.all(C)}),4);
case 4:return Q.return({mainVideoEntity:D,channelEntity:J})}})},QQf=function(A,L,B){this.N=A;
this.L=L;this.V=B},i29=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw;
return g.c(function(ry){switch(ry.N){case 1:return B=JH(L),f=[],g.X(ry,XD.getInstance(),2);case 2:K=ry.W;if(!K){ry.Ux(3);break}return g.X(ry,K.get("sdois"),4);case 4:return V=ry.W,g.X(ry,(R=K)==null?void 0:R.get("lmqf"),5);case 5:J=ry.W;case 3:g.S5(ry,6);if(V===void 0)throw Error("prefStorage or opt-in state is undefined");Z=[];if(V){ry.Ux(8);break}return g.X(ry,p3w(A.N),9);case 9:Z=ry.W,Z.reverse();case 8:if(!Z.length){ry.Ux(10);break}N=g.m(Z);F=N.next();case 11:if(F.done){ry.Ux(10);break}D=F.value;
if(!D){ry.Ux(12);break}I=g.Pv(D).entityId;return g.X(ry,rB(A.N,I),14);case 14:return d=ry.W,d.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.X(ry,gB(I,A.N,{entityKey:D,actionType:L.actionType},A.V,d),12);case 12:F=N.next();ry.Ux(11);break;case 10:return g.X(ry,$Ow(V,(w=J)!=null?w:"SD"),16);case 16:return r=ry.W,g.X(ry,dOK(r),17);case 17:h=w3X(r);if(!A.L.J("woffle_enable_main_downloads_library")){ry.Ux(18);break}if(V){ry.Ux(19);break}return g.X(ry,gZI(A.N,g.CI),19);case 19:return g.X(ry,
jxt(A.N,[g.CI]),18);case 18:if((Q=h)==null?0:Q.length)for(l=g.m(h),C=l.next();!C.done;C=l.next())if(v=O=C.value,U=v.actionType,a=v.entityKey,o0=v.actionMetadata,U&&a&&o0&&!g.y(o0,C0B)){U==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(o0.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(B6=g.y(O.actionMetadata,Pn))B6.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",O.actionMetadata=Object.assign({},O.actionMetadata,{mainVideoEntityActionMetadata:B6});f.push(O)}g.ZR(ry,
7);break;case 6:return Ve=g.NX(ry),DS="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",fw="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ve instanceof g.Il&&Ve.type==="QUOTA_EXCEEDED"&&(DS="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",fw="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ry.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,DS,fw));case 7:return ry.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,f))}})},$WR=function(){Wn.apply(this,
arguments);
this.yj="mainVideoEntity"},Xcw=function(A,L,B){L=L===void 0?43200:L;
B=B===void 0?!0:B;var f=f===void 0?!1:f;var K,V,J;return g.c(function(R){switch(R.N){case 1:if(!A.T.Dr())return R.return([]);K=[];g.S5(R,2);return g.X(R,CmX(L,B,f),4);case 4:K=R.W;g.ZR(R,3);break;case 2:V=g.NX(R),V instanceof Error&&V.message==="No data"||V instanceof Error&&V.message==="Empty response body"&&LB(V.message);case 3:return J=F7X(A,K,B,"mainPlaylistEntity"),R.return(J)}})},O2f=function(A,L,B,f){f=f===void 0?!1:f;
var K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l;return g.c(function(C){switch(C.N){case 1:return K=[],g.X(C,icI(),2);case 2:return(V=C.W)||f?g.X(C,X3t(L,B),3):C.return([]);case 3:J=C.W;if((R=J)==null||!R.length)return C.return([]);Z={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};N=g.m(J);F=N.next();case 4:if(F.done){C.Ux(6);break}I=D=F.value;d=I.actionType;w=I.entityKey;r=I.actionMetadata;if(!(d&&w&&r)||g.y(r,C0B)){C.Ux(5);break}d==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(r.offlineLoggingData=
Z);h=g.Pv(w);Q=h.entityId;return g.X(C,vn(A,[Q],"mainVideoEntity",d,r),8);case 8:l=C.W,K=K.concat(l);case 5:F=N.next();C.Ux(4);break;case 6:return C.return(K)}})},EMw=function(A,L){this.N=A;
this.V=L},MAw=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q;
return g.c(function(l){switch(l.N){case 1:return B=JH(L),f=g.Pv(L.entityKey),K=f.entityId,V=[],g.S5(l,2),g.X(l,cuB(A,K),4);case 4:V=l.W;if((J=V)==null||!J.length){l.Ux(5);break}return g.X(l,hjf(A.N,L.entityKey),5);case 5:g.ZR(l,3);break;case 2:return R=g.NX(l),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.Il&&R.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,Z,N));case 3:return F=[],g.X(l,faf(A.N,"musicTrack",V),7);case 7:V=l.W;if(V.length)for(D=g.m(V),I=D.next();!I.done;I=D.next())if(d=I.value,w=d.offlineVideoData,r=void 0,(r=w)==null?0:r.videoId)h=void 0,Q=Number(((h=L.actionMetadata)==null?void 0:h.priority)||0)+1,F.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w.videoId,"musicTrack",Q,xJ,bK(L,w,K)));return l.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,F))}})},
Ykt=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw,Xk,e5,mt,T,aO,YW,R0,TK,b,Lw,ro,SZ,xg,R8,a0,oO,tO,k,H,t,E,e,SE,z,P,M,mv;
return g.c(function(Qe){switch(Qe.N){case 1:return B=JH(L),f=L.entityKey,K=g.Pv(f).entityId,V=[],J=!1,K==="!*$_ALL_ENTITIES_!*$"?(J=!0,g.X(Qe,n7(A.N,"musicAlbumRelease"),5)):g.X(Qe,eJ(A.N,f,"musicAlbumRelease"),4);case 4:(R=Qe.W)&&V.push(R);Qe.Ux(3);break;case 5:V=Qe.W;case 3:if((Z=V)==null||!Z.length)return Qe.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));if(J){N=[];F=g.m(V);for(D=F.next();!D.done;D=F.next())I=D.value,d=g.Pv(I.id).entityId,N.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
d,"musicAlbumRelease",0,xJ));return Qe.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,N))}w=[];r=V[0];h=void 0;if(!r.downloadMetadata){Qe.Ux(6);break}return g.X(Qe,eJ(A.N,r.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:Q=Qe.W,h=Number((C=(l=Q)==null?void 0:l.addedTimestampMillis)!=null?C:"0")/1E3;case 6:return g.S5(Qe,8),g.X(Qe,cuB(A,K,(O=h)==null?void 0:O.toString()),10);case 10:w=Qe.W;g.ZR(Qe,9);break;case 8:v=g.NX(Qe);if(!(v instanceof Error&&v.message===
"No data")){if(v instanceof Error&&v.message==="Empty response body")LB(v.message);else return U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.Il&&v.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Qe.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,U,a));Qe.Ux(9);break}return g.X(Qe,Hn(K,"musicAlbumRelease",A.N,
L,A.V),9);case 9:o0=[];B6=new Map;if((Ve=w)==null?0:Ve.length)for(DS=g.m(w),fw=DS.next();!fw.done;fw=DS.next())ry=fw.value,uL=ry.offlineVideoData,Jf=void 0,((Jf=uL)==null?0:Jf.videoId)&&B6.set(uL.videoId,uL);MC=new Map;nw=[];if((Xk=r)==null?0:(e5=Xk.tracks)==null?0:e5.length)for(mt=g.m(r.tracks),T=mt.next();!T.done;T=mt.next())if(aO=T.value,YW=g.Pv(aO).entityId)B6.has(YW)?(MC.set(YW,B6.get(YW)),B6.delete(YW)):nw.push(YW);TK=Number(((R0=L.actionMetadata)==null?void 0:R0.priority)||0)+1;b=g.m(B6.entries());
for(Lw=b.next();!Lw.done;Lw=b.next())ro=Lw.value,SZ=g.m(ro),xg=SZ.next().value,R8=SZ.next().value,a0=xg,oO=R8,o0.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a0,"musicTrack",TK,xJ,bK(L,oO)));tO=g.m(MC.entries());for(k=tO.next();!k.done;k=tO.next())H=k.value,t=g.m(H),E=t.next().value,e=t.next().value,SE=E,z=e,o0.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",SE,"musicTrack",TK,xJ,bK(L,z)));P=g.m(nw);for(M=P.next();!M.done;M=P.next())mv=M.value,o0.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
mv,"musicTrack",0,xJ));return Qe.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,o0))}})},UW9=function(A,L){var B,f;
return g.c(function(K){switch(K.N){case 1:return B=JH(L),g.S5(K,2),f=g.Pv(L.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.X(K,hH(A.N,L,A.V),5):g.X(K,Hn(f,"musicAlbumRelease",A.N,L,A.V),6);case 6:return g.X(K,bct(A.N,L.entityKey),5);case 5:g.ZR(K,3);break;case 2:return g.NX(K),K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B))}})},cuB=function(A,L,B){var f,K,V;
return g.c(function(J){switch(J.N){case 1:return g.X(J,mOf([L]),2);case 2:return f=J.W,g.X(J,W75(A,f[0],B),3);case 3:return K=J.W,V=dB(K.thumbnailDetails),g.X(J,jI(V),4);case 4:return J.return(f[0].videos)}})},W75=function(A,L,B){var f,K,V,J,R,Z,N,F,D,I,d,w,r,h;
return g.c(function(Q){if(Q.N==1){f=L.additionalMetadadatas;K=void 0;if(f&&f.length>0)for(V=g.m(f),J=V.next();!J.done;J=V.next())if(R=J.value,R.offlineMusicPlaylistData){K=R.offlineMusicPlaylistData;break}Z=L.playlistId;N=tWd(L);F=N.SA;D=N.RX;I=B?(Number(B)*1E3).toString():Date.now().toString();d=L.lastModifiedTimestamp?(Number(L.lastModifiedTimestamp)*1E3).toString():"0";w={id:g.xv(Z,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:D,lastModifiedTimestampMillis:d,addedTimestampMillis:I,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};r={id:g.xv(Z,"musicAlbumRelease"),title:L.title,audioPlaylistId:Z,trackCount:L.totalVideoCount,tracks:F,downloadMetadata:w.id};K&&(r.thumbnailDetails=(h=K.albumHqThumbnail)!=null?h:K.albumArtistThumbnail,r.artistDisplayName=K.albumArtistDisplayName,r.releaseDate=K.albumReleaseDate,r.contentRating={explicitType:K.albumReleaseExplicitType},r.releaseType=K.albumReleaseType);return g.X(Q,Px(A.N,{mode:"readwrite",Ev:!0},function(l){var C=Uo(l,r,"musicAlbumRelease");
l=Uo(l,w,"musicAlbumReleaseDownloadMetadataEntity");return g.r2.all([C,l])}),2)}return Q.return(r)})},vMt=function(A,L){this.N=A;
this.V=L},P0f=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q;
return g.c(function(l){switch(l.N){case 1:return B=JH(L),f=g.Pv(L.entityKey),K=f.entityId,V=[],g.S5(l,2),g.X(l,qkI(A,K),4);case 4:V=l.W;if((J=V)==null||!J.length){l.Ux(5);break}return g.X(l,hjf(A.N,L.entityKey),5);case 5:g.ZR(l,3);break;case 2:return R=g.NX(l),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.Il&&R.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,Z,N));case 3:return F=[],g.X(l,faf(A.N,"musicTrack",V),7);case 7:V=l.W;if(V.length)for(D=g.m(V),I=D.next();!I.done;I=D.next())if(d=I.value,w=d.offlineVideoData,r=void 0,(r=w)==null?0:r.videoId)h=void 0,Q=Number(((h=L.actionMetadata)==null?void 0:h.priority)||0)+1,F.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w.videoId,"musicTrack",Q,eI,bK(L,w,K)));return l.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,F))}})},
xWX=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw,Xk,e5,mt,T,aO,YW,R0,TK,b,Lw,ro,SZ,xg,R8,a0,oO,tO,k,H,t,E,e,SE,z,P,M,mv,Qe,ye,T8,ff,t1,Yg,eZ,nf,lL,W4,Cw,sd;
return g.c(function(Y7){switch(Y7.N){case 1:return B=JH(L),f=L.entityKey,K=g.Pv(f).entityId,V=[],J=!1,K==="!*$_ALL_ENTITIES_!*$"?(J=!0,g.X(Y7,n7(A.N,"musicPlaylist"),5)):g.X(Y7,eJ(A.N,f,"musicPlaylist"),4);case 4:(R=Y7.W)&&V.push(R);Y7.Ux(3);break;case 5:V=Y7.W;case 3:if((Z=V)==null||!Z.length)return Y7.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));N=g.y(L.actionMetadata,k1f);D=(F=N)==null?void 0:F.autoSync;I=[];w=d=!0;r=!1;h=void 0;if(!J&&D===!1){Y7.Ux(6);break}g.S5(Y7,7);return g.X(Y7,
OcK(0,!!D,!0,V),9);case 9:I=Y7.W;g.ZR(Y7,8);break;case 7:Q=g.NX(Y7);if(!(Q instanceof Error&&Q.message==="No data")){Q instanceof Error&&Q.message==="Empty response body"&&LB(Q.message);Y7.Ux(8);break}return K==="!*$_ALL_ENTITIES_!*$"?g.X(Y7,hH(A.N,L,A.V),8):g.X(Y7,Hn(K,"musicPlaylist",A.N,L,A.V),8);case 8:if(!I.length||!J&&I[0].playlistId!==K)return Y7.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));case 6:if(J){l=[];C=g.m(I);for(O=C.next();!O.done;O=C.next())v=O.value,v.upToDate||
D&&!v.shouldAutoSyncMetadata||!v.playlistId||(U={autoSync:D},l.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",v.playlistId,"musicPlaylist",0,eI,{musicPlaylistEntityActionMetadata:U})));return Y7.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,l))}I.length&&(a=I[0],r=!!a.upToDate,D&&(d=(o0=a.shouldAutoSyncMetadata)!=null?o0:!0,w=(B6=a.shouldAutoSyncVideos)!=null?B6:!0,a.checkInSeconds&&(h=a.checkInSeconds)));if(r||!d)return Y7.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B));Ve=[];DS=V[0];fw=void 0;if(!DS.downloadMetadata){Y7.Ux(15);break}return g.X(Y7,eJ(A.N,DS.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:ry=Y7.W,fw=Number((Jf=(uL=ry)==null?void 0:uL.addedTimestampMillis)!=null?Jf:"0")/1E3;case 15:return g.S5(Y7,17),g.X(Y7,qkI(A,K,(MC=fw)==null?void 0:MC.toString(),h),19);case 19:Ve=Y7.W;g.ZR(Y7,18);break;case 17:nw=g.NX(Y7);if(!(nw instanceof Error&&nw.message==="No data")){if(nw instanceof Error&&nw.message==="Empty response body")LB(nw.message);
else return Xk="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",nw instanceof g.Il&&nw.type==="QUOTA_EXCEEDED"&&(Xk="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y7.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,Xk,e5));Y7.Ux(18);break}return g.X(Y7,Hn(K,"musicPlaylist",A.N,L,A.V),18);case 18:if(!w)return Y7.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B));mt=[];T=new Map;if((aO=Ve)==null?0:aO.length)for(YW=g.m(Ve),R0=YW.next();!R0.done;R0=YW.next())TK=R0.value,b=TK.offlineVideoData,Lw=void 0,((Lw=b)==null?0:Lw.videoId)&&T.set(b.videoId,b);ro=new Map;SZ=[];if((xg=DS)==null?0:(R8=xg.tracks)==null?0:R8.length)for(a0=g.m(DS.tracks),oO=a0.next();!oO.done;oO=a0.next())if(tO=oO.value,k=g.Pv(tO).entityId)T.has(k)?(ro.set(k,T.get(k)),T.delete(k)):SZ.push(k);t=Number(((H=L.actionMetadata)==null?void 0:H.priority)||0)+1;E=g.m(T.entries());for(e=E.next();!e.done;e=
E.next())SE=e.value,z=g.m(SE),P=z.next().value,M=z.next().value,mv=P,Qe=M,mt.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",mv,"musicTrack",t,eI,bK(L,Qe)));ye=g.m(ro.entries());for(T8=ye.next();!T8.done;T8=ye.next())ff=T8.value,t1=g.m(ff),Yg=t1.next().value,eZ=t1.next().value,nf=Yg,lL=eZ,mt.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",nf,"musicTrack",t,eI,bK(L,lL)));W4=g.m(SZ);for(Cw=W4.next();!Cw.done;Cw=W4.next())sd=Cw.value,mt.push(lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",sd,"musicTrack",
0,eI));return Y7.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,mt))}})},evf=function(A,L){var B,f;
return g.c(function(K){switch(K.N){case 1:return B=JH(L),g.S5(K,2),f=g.Pv(L.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.X(K,hH(A.N,L,A.V),5):g.X(K,Hn(f,"musicPlaylist",A.N,L,A.V),6);case 6:return g.X(K,bct(A.N,L.entityKey),5);case 5:g.ZR(K,3);break;case 2:return g.NX(K),K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B))}})},qkI=function(A,L,B,f){var K,V,J;
return g.c(function(R){switch(R.N){case 1:return g.X(R,mOf([L]),2);case 2:return K=R.W,g.X(R,nMd(A,K[0],B,f),3);case 3:return V=R.W,J=dB(V.thumbnailDetails),g.X(R,jI(J),4);case 4:return R.return(K[0].videos)}})},nMd=function(A,L,B,f){var K,V,J,R,Z,N,F,D,I;
return g.c(function(d){return d.N==1?(K=L.playlistId,V=tWd(L),J=V.SA,R=V.RX,Z=B?(Number(B)*1E3).toString():Date.now().toString(),N=L.lastModifiedTimestamp?(Number(L.lastModifiedTimestamp)*1E3).toString():"0",F={id:g.xv(K,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:R,lastModifiedTimestampMillis:N,addedTimestampMillis:Z,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},D={id:g.xv(K,"musicPlaylist"),title:L.title,playlistId:K,thumbnailDetails:L.thumbnail,visibility:zvW(L),trackCount:L.totalVideoCount,
tracks:J,downloadMetadata:F.id},f&&(((I=D)==null?0:I.entityMetadata)?D.entityMetadata.nextAutoRefreshIntervalSeconds=String(f):D&&(D.entityMetadata={nextAutoRefreshIntervalSeconds:String(f)})),g.X(d,Px(A.N,{mode:"readwrite",Ev:!0},function(w){var r=Uo(w,D,"musicPlaylist");w=Uo(w,F,"musicPlaylistDownloadMetadataEntity");return g.r2.all([r,w])}),2)):d.return(D)})},zvW=function(A){switch(A.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},umf=function(A,L){this.N=A;
this.V=L},owK=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w;
return g.c(function(r){switch(r.N){case 1:return B=JH(L),f=g.Pv(L.entityKey),K=f.entityId,V=g.y(L.actionMetadata,aH5),g.S5(r,2),g.X(r,AXB(A,K,void 0,(J=V)==null?void 0:J.track,(R=V)==null?void 0:R.albumRelease),4);case 4:if((Z=V)==null?0:Z.playlistId){r.Ux(5);break}return g.X(r,hjf(A.N,L.entityKey),5);case 5:g.ZR(r,3);break;case 2:return N=g.NX(r),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.Il&&N.type==="QUOTA_EXCEEDED"&&
(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),r.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,F,D));case 3:d=Number(((I=L.actionMetadata)==null?void 0:I.priority)||0)+1;var h=(h=g.y(L.actionMetadata,aH5))?{playbackDataActionMetadata:{maximumDownloadQuality:h.maximumDownloadQuality}}:void 0;w=lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K,"playbackData",d,LK5,h);return r.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B,[w]))}})},BlR=function(A,L){var B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h;
return g.c(function(Q){switch(Q.N){case 1:return B=JH(L),f=g.Pv(L.entityKey),K=f.entityId,g.X(Q,eJ(A.N,L.entityKey,"musicTrack"),2);case 2:V=Q.W;if(!V){J=void 0;Q.Ux(3);break}return g.X(Q,eJ(A.N,V.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:J=Q.W;case 3:R=J;if(!V||!R)return Q.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B));N=g.y(L.actionMetadata,aH5);g.S5(Q,5);return g.X(Q,AXB(A,K,R.addedTimestampMillis,(F=N)==null?void 0:F.track,(D=N)==null?void 0:D.albumRelease),
7);case 7:d=Number(((I=L.actionMetadata)==null?void 0:I.priority)||0)+1;Z=lK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K,"playbackData",d,LK5);g.ZR(Q,6);break;case 5:w=g.NX(Q);if(!(w instanceof Error&&w.message==="No data")){if(w instanceof Error&&w.message==="Empty response body")LB(w.message);else return r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.Il&&w.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Q.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,r,h));Q.Ux(6);break}return g.X(Q,s8(K,A.N,L,A.V),6);case 6:return Q.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",B,Z?[Z]:void 0))}})},ftw=function(A,L){var B,f;
return g.c(function(K){switch(K.N){case 1:return B=JH(L),g.S5(K,2),f=g.Pv(L.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.X(K,hH(A.N,L,A.V),5):g.X(K,s8(f,A.N,L,A.V),6);case 6:return g.X(K,bct(A.N,L.entityKey),5);case 5:g.ZR(K,3);break;case 2:return g.NX(K),K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",B,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new m3("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
B))}})},AXB=function(A,L,B,f,K){var V,J,R,Z,N,F;
return g.c(function(D){switch(D.N){case 1:if(V=f){D.Ux(2);break}return g.X(D,lat([L]),3);case 3:J=D.W,R=J[0],V=Hcf(R);case 2:return g.X(D,KKf(A,V,L,K,B),4);case 4:Z=D.W;N=Z.musicTrackEntity;F=Z.U4;var I=dB(N.thumbnailDetails),d=[];F&&(d=dB(F.thumbnailDetails));return g.X(D,jI(I.concat(d)),0)}})},KKf=function(A,L,B,f,K){var V;
return g.c(function(J){return J.N==1?(K||(K=Date.now().toString()),V={id:g.xv(B,"musicTrackDownloadMetadataEntity"),playbackData:g.xv(B,"playbackData"),addedTimestampMillis:K,videoDownloadContextEntity:g.xv(B,"videoDownloadContextEntity")},f&&(L.albumRelease=f.id),g.X(J,Px(A.N,{mode:"readwrite",Ev:!0},function(R){var Z=[],N=Uo(R,V,"musicTrackDownloadMetadataEntity");Z.push(N);N=Uo(R,L,"musicTrack");Z.push(N);f&&(R=Uo(R,f,"musicAlbumRelease"),Z.push(R));return g.r2.all(Z)}),2)):J.N!=3?g.X(J,N6(B,"musicTrackDownloadMetadataEntity",
A.N,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):J.return({musicTrackEntity:L,
U4:f})})},nB=function(){Wn.apply(this,arguments);
this.yj="musicTrack"},VFt=function(A,L,B){L=L===void 0?43200:L;
B=B===void 0?!0:B;var f=f===void 0?!1:f;var K,V;return g.c(function(J){switch(J.N){case 1:if(!A.T.Dr())return J.return([]);K=[];g.S5(J,2);return g.X(J,OcK(L,B,f),4);case 4:K=J.W;g.ZR(J,3);break;case 2:g.NX(J);case 3:return V=F7X(A,K,B,"musicPlaylist"),J.return(V)}})},JXt=function(){g.FB.apply(this,arguments);
var A=this;this.events=new g.dN(this);this.L=this.player.K();this.GV={wq1:function(){return A.N},
D9:function(){return A.D9()},
DK:function(L){return A.DK(L)}}},SBW=function(A){var L;
A=g.y((L=A.getWatchNextResponse())==null?void 0:L.currentVideoEndpoint,g.FZ);if(A==null?0:A.playlistId)var B=A.playlistId;return B},RMK=function(A,L){var B,f,K,V;
return g.c(function(J){if(J.N==1){B=L.clientPlaybackNonce;f={cpn:B,offlineSourceVisualElement:g.jB(L.Wn||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};L.W&&(f.videoFmt=Number(L.W.itag));L.U&&(f.audioFmt=Number(L.U.itag));if((K=SBW(L))&&L.videoId){var R=L.videoId;R=K!=="PPSV"?Promise.resolve(!1):A.N.xB(R);J=g.X(J,R,3)}else J=J.Ux(2);return J}J.N!=2&&(V=J.W)&&(f.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");A.W=B;g.pE("offlinePlaybackStarted",f);g.VK(J)})};
g.$n.prototype.Jp=g.ED(41,function(A){return this.app.Jp(A)});
g.D$.prototype.Jp=g.ED(40,function(A){return g.VJC(this,9,A)});
g.G(iU,C7);g.v6.Object.defineProperties(iU.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.N.entityMetadata},
set:function(A){this.N.entityMetadata=A}}});
g.G(nEd,iU);nEd.prototype.W=function(){return[]};
g.G(z4d,iU);z4d.prototype.W=function(){return[]};
g.G(ust,iU);ust.prototype.W=function(){return[]};
g.G(anX,iU);anX.prototype.W=function(){return[]};
g.G(AW9,iU);AW9.prototype.W=function(){return[]};
g.G(L2w,iU);L2w.prototype.W=function(){var A=[];this.N.alternateChannel&&A.push(this.N.alternateChannel);this.N.alternateChannelList&&A.push.apply(A,g.x7(this.N.alternateChannelList));this.N.oneofChannelEntity&&A.push(this.N.oneofChannelEntity);return[].concat(g.x7(new Set(A)))};
g.G(osf,iU);osf.prototype.W=function(){var A=[];this.N.entryCollection&&A.push(this.N.entryCollection);return[].concat(g.x7(new Set(A)))};
g.G(BFf,C7);BFf.prototype.W=function(){var A=[];this.N.video&&A.push(this.N.video);return[].concat(g.x7(new Set(A)))};
g.G(fXW,iU);fXW.prototype.W=function(){var A=[];this.N.parentPlaylist&&A.push(this.N.parentPlaylist);if(this.N.entries)for(var L=g.m(this.N.entries),B=L.next();!B.done;B=L.next())A.push.apply(A,g.x7((new BFf(B.value)).W()));return[].concat(g.x7(new Set(A)))};
g.G(K25,iU);K25.prototype.W=function(){var A=[];this.N.descriptionEntity&&A.push(this.N.descriptionEntity);this.N.creators&&A.push.apply(A,g.x7(this.N.creators));this.N.theBiggestFan&&A.push(this.N.theBiggestFan);return[].concat(g.x7(new Set(A)))};
g.G(VXW,iU);VXW.prototype.W=function(){return[]};
g.G(JWX,iU);JWX.prototype.W=function(){return[]};
g.G(Sw9,iU);Sw9.prototype.W=function(){return[]};
g.G(Rt9,iU);Rt9.prototype.W=function(){return[]};
g.G(ZCd,iU);ZCd.prototype.W=function(){return[]};
g.G(NF5,iU);NF5.prototype.W=function(){return[]};
g.G(F2w,iU);F2w.prototype.W=function(){return[]};
g.G(Dl5,iU);Dl5.prototype.W=function(){return[]};
g.G(dlw,iU);dlw.prototype.W=function(){return[]};
g.G(IXR,iU);IXR.prototype.W=function(){var A=[];this.N.downloadsList&&A.push(this.N.downloadsList);this.N.smartDownloadsList&&A.push(this.N.smartDownloadsList);this.N.recommendedDownloadsList&&A.push(this.N.recommendedDownloadsList);this.N.refresh&&A.push(this.N.refresh);return[].concat(g.x7(new Set(A)))};
g.G(wIR,C7);wIR.prototype.W=function(){var A=[];this.N.video&&A.push(this.N.video);this.N.playlist&&A.push(this.N.playlist);this.N.videoItem&&A.push(this.N.videoItem);this.N.playlistItem&&A.push(this.N.playlistItem);return[].concat(g.x7(new Set(A)))};
g.G(pIW,iU);pIW.prototype.W=function(){var A=[];this.N.refresh&&A.push(this.N.refresh);if(this.N.downloads)for(var L=g.m(this.N.downloads),B=L.next();!B.done;B=L.next())A.push.apply(A,g.x7((new wIR(B.value)).W()));return[].concat(g.x7(new Set(A)))};
g.G(yWw,iU);yWw.prototype.W=function(){var A=[];this.N.localImageEntities&&A.push.apply(A,g.x7(this.N.localImageEntities));return[].concat(g.x7(new Set(A)))};
g.G(jFw,iU);jFw.prototype.W=function(){var A=[];this.N.playbackData&&A.push(this.N.playbackData);this.N.localImageEntities&&A.push.apply(A,g.x7(this.N.localImageEntities));this.N.videoDownloadContextEntity&&A.push(this.N.videoDownloadContextEntity);return[].concat(g.x7(new Set(A)))};
g.G(gst,iU);gst.prototype.W=function(){return[]};
g.G(GrR,iU);GrR.prototype.W=function(){var A=[];this.N.fakeChildren&&A.push.apply(A,g.x7(this.N.fakeChildren));return[].concat(g.x7(new Set(A)))};
g.G(rWt,iU);rWt.prototype.W=function(){var A=[];this.N.video&&A.push(this.N.video);this.N.playbackData&&A.push(this.N.playbackData);this.N.offlineVideoPolicy&&A.push(this.N.offlineVideoPolicy);return[].concat(g.x7(new Set(A)))};
g.G(sFw,iU);sFw.prototype.W=function(){return[]};
g.G(HCW,iU);HCW.prototype.W=function(){var A=[];this.N.channelOwner&&A.push(this.N.channelOwner);this.N.videos&&A.push.apply(A,g.x7(this.N.videos));this.N.collaboratorChannels&&A.push.apply(A,g.x7(this.N.collaboratorChannels));this.N.downloadState&&A.push(this.N.downloadState);this.N.refresh&&A.push(this.N.refresh);return[].concat(g.x7(new Set(A)))};
g.G(htf,iU);htf.prototype.W=function(){var A=[];this.N.video&&A.push(this.N.video);this.N.channelContributor&&A.push(this.N.channelContributor);return[].concat(g.x7(new Set(A)))};
g.G(bCX,C7);bCX.prototype.W=function(){var A=[];this.N.localImageEntities&&A.push.apply(A,g.x7(this.N.localImageEntities));this.N.videoDownloadContextEntity&&A.push(this.N.videoDownloadContextEntity);return[].concat(g.x7(new Set(A)))};
g.G(tX5,C7);tX5.prototype.W=function(){var A=[];this.N.recommendedVideoMetadata&&A.push.apply(A,g.x7((new bCX(this.N.recommendedVideoMetadata)).W()));return[].concat(g.x7(new Set(A)))};
g.G(krw,C7);krw.prototype.W=function(){var A=[];this.N.playbackPosition&&A.push(this.N.playbackPosition);return[].concat(g.x7(new Set(A)))};
g.G(TFI,iU);TFI.prototype.W=function(){var A=[];this.N.owner&&A.push(this.N.owner);this.N.downloadState&&A.push(this.N.downloadState);this.N.userState&&A.push.apply(A,g.x7((new krw(this.N.userState)).W()));this.N.additionalMetadata&&A.push.apply(A,g.x7((new tX5(this.N.additionalMetadata)).W()));return[].concat(g.x7(new Set(A)))};
g.G(lXI,iU);lXI.prototype.W=function(){var A=[];this.N.userChannelDetails&&A.push(this.N.userChannelDetails);return[].concat(g.x7(new Set(A)))};
g.G(mlX,iU);mlX.prototype.W=function(){var A=[];this.N.channelOwner&&A.push(this.N.channelOwner);this.N.playbackPosition&&A.push(this.N.playbackPosition);this.N.localImageEntities&&A.push.apply(A,g.x7(this.N.localImageEntities));this.N.downloadStatus&&A.push(this.N.downloadStatus);return[].concat(g.x7(new Set(A)))};
g.G(QFd,iU);QFd.prototype.W=function(){return[]};
g.G(Cpw,iU);Cpw.prototype.W=function(){return[]};
g.G(iCI,iU);iCI.prototype.W=function(){return[]};
g.G($lK,iU);$lK.prototype.W=function(){return[]};
g.G(XIw,iU);XIw.prototype.W=function(){return[]};
g.G(OCw,iU);OCw.prototype.W=function(){return[]};
g.G(Esw,iU);Esw.prototype.W=function(){return[]};
g.G(cWK,iU);cWK.prototype.W=function(){return[]};
g.G(MXt,iU);MXt.prototype.W=function(){return[]};
g.G(YwX,iU);YwX.prototype.W=function(){return[]};
g.G(UlO,iU);UlO.prototype.W=function(){return[]};
g.G(W2d,iU);W2d.prototype.W=function(){return[]};
g.G(vsK,iU);vsK.prototype.W=function(){return[]};
g.G(qwf,iU);qwf.prototype.W=function(){var A=[];this.N.compositeSourceKeys&&A.push.apply(A,g.x7(this.N.compositeSourceKeys));return[].concat(g.x7(new Set(A)))};
g.G(PpR,iU);PpR.prototype.W=function(){var A=[];this.N.trackDownloadMetadatas&&A.push.apply(A,g.x7(this.N.trackDownloadMetadatas));return[].concat(g.x7(new Set(A)))};
g.G(xlw,iU);
xlw.prototype.W=function(){var A=[];this.N.downloadedTracks&&A.push.apply(A,g.x7(this.N.downloadedTracks));this.N.smartDownloadedTracks&&A.push.apply(A,g.x7(this.N.smartDownloadedTracks));this.N.downloadedEpisodes&&A.push.apply(A,g.x7(this.N.downloadedEpisodes));this.N.downloadedAlbumReleases&&A.push.apply(A,g.x7(this.N.downloadedAlbumReleases));this.N.smartDownloadedAlbumReleases&&A.push.apply(A,g.x7(this.N.smartDownloadedAlbumReleases));this.N.downloadedPlaylists&&A.push.apply(A,g.x7(this.N.downloadedPlaylists));this.N.smartDownloadedPlaylists&&
A.push.apply(A,g.x7(this.N.smartDownloadedPlaylists));this.N.metadataOnlyTracks&&A.push.apply(A,g.x7(this.N.metadataOnlyTracks));return[].concat(g.x7(new Set(A)))};
g.G(etW,iU);etW.prototype.W=function(){var A=[];this.N.trackDownloadMetadatas&&A.push.apply(A,g.x7(this.N.trackDownloadMetadatas));return[].concat(g.x7(new Set(A)))};
g.G(nsK,iU);nsK.prototype.W=function(){var A=[];this.N.playbackData&&A.push(this.N.playbackData);this.N.localImageEntities&&A.push.apply(A,g.x7(this.N.localImageEntities));this.N.videoDownloadContextEntity&&A.push(this.N.videoDownloadContextEntity);return[].concat(g.x7(new Set(A)))};
g.G(ztB,iU);ztB.prototype.W=function(){var A=[];this.N.musicLibraryStatusEntity&&A.push(this.N.musicLibraryStatusEntity);this.N.primaryArtists&&A.push.apply(A,g.x7(this.N.primaryArtists));this.N.details&&A.push(this.N.details);this.N.userDetails&&A.push(this.N.userDetails);this.N.tracks&&A.push.apply(A,g.x7(this.N.tracks));this.N.share&&A.push(this.N.share);this.N.downloadMetadata&&A.push(this.N.downloadMetadata);this.N.refresh&&A.push(this.N.refresh);return[].concat(g.x7(new Set(A)))};
g.G(uI9,iU);uI9.prototype.W=function(){var A=[];this.N.albumRelease&&A.push(this.N.albumRelease);this.N.tracks&&A.push.apply(A,g.x7(this.N.tracks));return[].concat(g.x7(new Set(A)))};
g.G(aXO,iU);aXO.prototype.W=function(){var A=[];this.N.albumRelease&&A.push(this.N.albumRelease);return[].concat(g.x7(new Set(A)))};
g.G(AgO,iU);AgO.prototype.W=function(){var A=[];this.N.details&&A.push(this.N.details);this.N.userDetails&&A.push(this.N.userDetails);return[].concat(g.x7(new Set(A)))};
g.G(LlW,iU);LlW.prototype.W=function(){var A=[];this.N.parentArtist&&A.push(this.N.parentArtist);return[].concat(g.x7(new Set(A)))};
g.G(o1K,iU);o1K.prototype.W=function(){var A=[];this.N.parentArtist&&A.push(this.N.parentArtist);return[].concat(g.x7(new Set(A)))};
g.G(BH9,iU);BH9.prototype.W=function(){return[]};
g.G(fx9,iU);fx9.prototype.W=function(){return[]};
g.G(Klf,C7);Klf.prototype.W=function(){var A=[];this.N.creatorEntity&&A.push(this.N.creatorEntity);return[].concat(g.x7(new Set(A)))};
g.G(Vqw,iU);
Vqw.prototype.W=function(){var A=[];this.N.tracks&&A.push.apply(A,g.x7(this.N.tracks));this.N.refresh&&A.push(this.N.refresh);this.N.musicLibraryStatusEntity&&A.push(this.N.musicLibraryStatusEntity);this.N.details&&A.push(this.N.details);this.N.downloadMetadata&&A.push(this.N.downloadMetadata);this.N.sideloadMetadata&&A.push(this.N.sideloadMetadata);this.N.userDetails&&A.push(this.N.userDetails);this.N.entryCollection&&A.push(this.N.entryCollection);this.N.share&&A.push(this.N.share);this.N.podcastShowAdditionalMetadata&&
A.push.apply(A,g.x7((new Klf(this.N.podcastShowAdditionalMetadata)).W()));return[].concat(g.x7(new Set(A)))};
g.G(Jgd,iU);Jgd.prototype.W=function(){return[]};
g.G(SxX,iU);
SxX.prototype.W=function(){var A=[];this.N.musicLibraryStatusEntity&&A.push(this.N.musicLibraryStatusEntity);this.N.artists&&A.push.apply(A,g.x7(this.N.artists));this.N.audioModeVersion&&A.push(this.N.audioModeVersion);this.N.videoModeVersion&&A.push(this.N.videoModeVersion);this.N.userDetails&&A.push(this.N.userDetails);this.N.details&&A.push(this.N.details);this.N.albumRelease&&A.push(this.N.albumRelease);this.N.share&&A.push(this.N.share);this.N.libraryEdit&&A.push(this.N.libraryEdit);this.N.downloadMetadata&&
A.push(this.N.downloadMetadata);this.N.playbackPosition&&A.push(this.N.playbackPosition);this.N.lyrics&&A.push(this.N.lyrics);return[].concat(g.x7(new Set(A)))};
g.G(Rrf,iU);Rrf.prototype.W=function(){var A=[];this.N.parentTrack&&A.push(this.N.parentTrack);return[].concat(g.x7(new Set(A)))};
g.G(Z9t,iU);Z9t.prototype.W=function(){var A=[];this.N.parentTrack&&A.push(this.N.parentTrack);return[].concat(g.x7(new Set(A)))};
g.G(NHO,iU);NHO.prototype.W=function(){return[]};
g.G(FlB,iU);FlB.prototype.W=function(){return[]};
g.G(DiB,iU);DiB.prototype.W=function(){return[]};
g.G(di5,iU);di5.prototype.W=function(){return[]};
g.G(IxW,iU);IxW.prototype.W=function(){var A=[];this.N.transfer&&A.push(this.N.transfer);this.N.adsPlaybackData&&A.push.apply(A,g.x7(this.N.adsPlaybackData));this.N.drmLicense&&A.push(this.N.drmLicense);this.N.offlineVideoPolicy&&A.push(this.N.offlineVideoPolicy);this.N.videoDownloadContextEntity&&A.push(this.N.videoDownloadContextEntity);return[].concat(g.x7(new Set(A)))};
g.G(w2W,iU);w2W.prototype.W=function(){return[]};
g.G(p2K,iU);p2K.prototype.W=function(){var A=[];this.N.offlineVideoStreams&&A.push.apply(A,g.x7(this.N.offlineVideoStreams));this.N.captionTrack&&A.push.apply(A,g.x7(this.N.captionTrack));return[].concat(g.x7(new Set(A)))};
g.G(ygd,iU);ygd.prototype.W=function(){return[]};
g.G(jtX,iU);jtX.prototype.W=function(){return[]};
g.G(g1R,iU);g1R.prototype.W=function(){return[]};
g.G(GHf,iU);GHf.prototype.W=function(){return[]};
g.G(rg5,iU);rg5.prototype.W=function(){return[]};
g.G(stB,iU);stB.prototype.W=function(){return[]};
g.G(H9O,iU);H9O.prototype.W=function(){return[]};
g.G(hrW,iU);hrW.prototype.W=function(){return[]};
g.G(b9W,iU);b9W.prototype.W=function(){return[]};
g.G(tqf,iU);tqf.prototype.W=function(){return[]};
g.G(kHI,iU);kHI.prototype.W=function(){return[]};
g.G(THR,iU);THR.prototype.W=function(){return[]};
g.G(lxK,iU);lxK.prototype.W=function(){return[]};
g.G(miR,iU);miR.prototype.W=function(){return[]};
g.G(QtK,iU);QtK.prototype.W=function(){return[]};
g.G(CCw,iU);CCw.prototype.W=function(){return[]};
g.G(i9B,iU);i9B.prototype.W=function(){return[]};
g.G($iB,iU);$iB.prototype.W=function(){return[]};
g.G(X2I,iU);X2I.prototype.W=function(){return[]};
g.G(O9K,iU);O9K.prototype.W=function(){return[]};
g.G(E1K,iU);E1K.prototype.W=function(){return[]};
g.G(cg9,iU);cg9.prototype.W=function(){return[]};
var EZK=["browse","music/browse","streaming_browse","unplugged/browse"],WQR=["offline/playlist_sync_check"],TmI=["offline"],c9w=["offline/offline_video_playback_position_sync"],Ya5=["offline/get_playback_data_entity"],$B;XD.getInstance=function(){return g.c(function(A){return A.return(new Promise(function(L){g.Ab().then(function(B){B?(XD.instance||(XD.instance=new XD(B)),L(XD.instance)):L(void 0)})}))})};
XD.prototype.get=function(A){var L=this,B,f,K;return g.c(function(V){if(V.N==1)return g.X(V,Wlf(L.token),2);if(V.N!=3)return B=V.W,g.X(V,B.get("prefs",A),3);f=V.W;if(!f)return V.return();K=(0,g.bc)();return f.expirationTimestampMs<=K?V.return():V.return(f.value)})};
XD.prototype.set=function(A,L,B){B=B===void 0?31536E3:B;var f=this,K,V,J;return g.c(function(R){if(R.N==1)return K=(0,g.bc)(),V={key:A,value:L,expirationTimestampMs:K+B*1E3},g.X(R,Wlf(f.token),2);J=R.W;return g.X(R,g.Cs(J,"prefs",V),0)})};
XD.prototype.remove=function(A){var L=this,B;return g.c(function(f){if(f.N==1)return g.X(f,Wlf(L.token),2);B=f.W;return g.X(f,B.delete("prefs",A),0)})};
g.G(Oo,g.iL);g.G(Eo,erR);Eo.prototype.V=function(A,L){L=zr9(L);A=(new TextEncoder).encode(JSON.stringify(A));return this.N.encrypt(A,L)};
Eo.prototype.W=function(A,L){if(!(A instanceof Uint8Array))throw v1t(1);var B=new TextDecoder;L=zr9(L);A=this.N.decrypt(A,L);return JSON.parse(B.decode(A))};
var u_f={accountLinkStatusEntity:Sw9,booleanEntity:anX,buttonEntity:QtK,captionTrack:NHO,channelHandle:nEd,chipEntity:H9O,commerceAcquisitionClientPayloadEntity:i9B,commerceCartListEntity:$iB,compositeSourceEntity:vsK,multiviewStagingEntity:qwf,contextNoteFeedEntityPayload:z4d,contextNoteUserRatingEntityPayload:ust,continuationTokenEntity:sFw,downloadQualityPickerEntity:F2w,downloadsPageRefreshTokenEntity:dlw,downloadsPageViewConfigurationEntity:QFd,downloadStatusEntity:Dl5,dismissState:hrW,sfvAudioItemCurrentlyPlayingEntity:GHf,
emojiFountainDataEntity:lxK,emojiCustomizationSetEntity:THR,fakeChannel:L2w,fakePlaylist:osf,fakePlaylistEntryCollection:fXW,fakeVideo:K25,fakeVideoDescription:VXW,featuredProductsEntity:YwX,flowStateEntity:JWX,iconBadgeEntity:X2I,interstitialInteractionStateEntity:ZCd,likeButtonAnimationEntity:Cpw,liveChatPollStateEntity:NF5,dataFreshnessEntity:kHI,liveViewerLeaderboardChatEntryPointStateEntity:jtX,liveViewerLeaderboardPointsEntity:g1R,liveReactionsDataEntity:miR,logoEntity:Rt9,macroMarkerEntity:iCI,
mainDownloadsLibraryEntity:IXR,mainDownloadsListEntity:pIW,mainPlaylistDownloadStateEntity:yWw,mainPlaylistEntity:HCW,mainPlaylistVideoEntity:htf,mainVideoDownloadStateEntity:jFw,mainVideoEntity:TFI,markersEngagementPanelSyncEntity:$lK,markersVisibilityOverrideEntity:XIw,musicAlbumReleaseDetail:uI9,musicAlbumReleaseDownloadMetadataEntity:PpR,musicAlbumRelease:ztB,musicAlbumReleaseUserDetail:aXO,musicArtistDetail:LlW,musicArtist:AgO,musicArtistUserDetail:o1K,musicDownloadsLibraryEntity:xlw,musicLibraryEdit:BH9,
musicLibraryStatusEntity:fx9,musicPlaylist:Vqw,musicPlaylistDownloadMetadataEntity:etW,musicShare:Jgd,musicTrackDetail:Rrf,musicTrackDownloadMetadataEntity:nsK,musicTrack:SxX,musicTrackUserDetail:Z9t,offlineOrchestrationActionWrapperEntity:FlB,offlineVideoPolicy:DiB,offlineVideoStreams:di5,offlineabilityEntity:gst,orchestrationWebSamplingEntity:GrR,pageHeaderEntity:b9W,pdpStateEntity:O9K,pinnedProductEntity:UlO,playbackData:IxW,playerStateEntity:OCw,quantityIncrementerEntity:E1K,refresh:w2W,saveToPlaylistListEntity:rg5,
selectedChipIndexEntityPayload:Esw,settingEntity:stB,stringEntity:AW9,suggestedFeedbackChipStateEntity:cWK,transfer:p2K,trendingOfferEntity:W2d,videoDownloadContextEntity:ygd,videoOverviewAsyncDataEntity:cg9,videoPlaybackPositionEntity:CCw,votingEntity:tqf,ytMainChannelEntity:lXI,youchatPendingResponseEntity:MXt,ytMainDownloadedVideoEntity:rWt,ytMainVideoEntity:mlX};g.G(vx,erR);vx.prototype.V=function(A){return A};
vx.prototype.W=function(A){if(A instanceof Uint8Array)throw v1t(0);return A};
g.G(qk,g.Y);qk.prototype.observe=function(A){var L=this;this.observers.push(A);return function(){var B=L.observers.indexOf(A);B>=0&&L.observers.splice(B,1)}};
qk.prototype.W=function(A){Fs9(this,A.data)};
qk.prototype.l1=function(){this.channel.close()};
var pr5,IaW=new g.CX("elementsCommand");var Gf=new g.CX("entityBatchUpdate");var BmK=new g.CX("downloadStatusEntity");var yuf=new g.CX("mainPlaylistEntityActionMetadata");var Pn=new g.CX("mainVideoEntityActionMetadata");var k1f=new g.CX("musicPlaylistEntityActionMetadata");var aH5=new g.CX("musicTrackEntityActionMetadata");var C0B=new g.CX("localImageEntityActionMetadata");var QZ=new g.CX("playbackDataActionMetadata");var ImX=new g.CX("transferEntityActionMetadata");var LNO=new g.CX("videoPlaybackPositionEntityActionMetadata");var Q3R;new g.IQ;new g.IQ;OtX.prototype.request=function(A,L,B){L=L===void 0?{}:L;return this.locks.request(A,L,function(f){return B(f)})};var AH=g.rI.caches,an,Un9;uU.prototype.open=function(A){return AH.open(MOX(A))};
uU.prototype.has=function(A){return AH.has(MOX(A))};
uU.prototype.delete=function(A){return AH.delete(MOX(A))};
uU.prototype.match=function(A,L){var B=this,f,K,V,J,R,Z;return g.c(function(N){switch(N.N){case 1:return g.X(N,B.keys(),2);case 2:f=N.W,K=g.m(f),V=K.next();case 3:if(V.done){N.Ux(5);break}J=V.value;return g.X(N,B.open(J),6);case 6:return R=N.W,g.X(N,R.match(A,L),7);case 7:if(Z=N.W)return N.return(Z);V=K.next();N.Ux(3);break;case 5:return N.return()}})};
g.G(c5w,uU);c5w.prototype.keys=function(){var A,L,B,f,K,V,J,R,Z;return g.c(function(N){if(N.N==1)return A=[],L=g.nn("CacheStorage keys"),g.X(N,AH.keys(),2);B=N.W;f=g.m(B);for(K=f.next();!K.done;K=f.next()){V=K.value;var F=V.indexOf(":");J=F===-1?{YK:V}:{YK:V.substring(0,F),datasyncId:V.substring(F+1)};R=J.YK;Z=J.datasyncId;Z===L&&A.push(R)}return N.return(A)})};g.G(oi,g.Y);oi.prototype.V=function(A){this.api.Kr("onOfflineOperationFailure",A.data)};
oi.prototype.U=function(A){this.api.publish("offlinetransferpause",A.data)};
oi.prototype.l1=function(){var A;(A=this.N)==null||A.close();var L;(L=this.W)==null||L.close()};q3w.prototype.wI=function(){this.N&&fB(this)};
q3w.prototype.VV=function(){this.W&&this.W.resolve();this.V=this.N=!1;this.yj()};var mBK=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var FQK="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var sxI="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.G(qa5,Tf);qa5.prototype.W=function(A){return SI(A)?ejd(this,A):Ri(A)?uuK(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};g.G(aaB,Tf);aaB.prototype.W=function(A){return Ri(A)?AUW(this,A):oZ9(A)?oAf(this,A):Ze(A)?Bb9(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};g.p=fmB.prototype;g.p.Xy4=function(A){var L=this,B,f,K,V;return g.c(function(J){if(!g.x(A.state,128))return J.Ux(0);B=A.state.nh;var R=(f=B)==null?void 0:f.errorCode,Z=(K=B)==null?void 0:K.V5;V=R==="net.connect"&&Z===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(R==null?0:R.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.X(J,L.ZA(L.player.getVideoData().videoId,V),0)})};
g.p.ZA=function(A,L){var B=this;return g.c(function(f){if(f.N==1){if(B.W)return f.return();B.W=!0;return L==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?($J(B,A,!1,!0),f.Ux(0)):g.X(f,iK(B,A),3)}g.qg(A,4);return g.X(f,B.N.ZA(L),0)})};
g.p.FG=function(A){A.status===2?(A.status!==this.V&&(amI(this.N),g.qg(A.videoId,2)),A.Hl&&fHK(this.N,A.videoId,A.Hl)):A.status===4?(iK(this,A.videoId),this.ZA(A.videoId,A.Hp?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):A.status===1&&Bsf(this.N);this.V=A.status;this.api.Kr("localmediachange",{videoId:A.videoId,status:A.status})};
g.p.UM=function(){var A=this,L;return g.c(function(B){if(B.N==1){if(A.W)return B.return();A.W=!0;L=A.player.getVideoData().videoId;return g.X(B,iK(A,L),2)}return g.X(B,A.N.UM(),0)})};
g.p.r8=function(A){switch(A){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.p.J=function(A){return this.api.K().J(A)};g.G(Z8R,Tf);Z8R.prototype.W=function(A){return SI(A)?FNB(this,A):Ri(A)?DBX(this,A):oZ9(A)?dB9(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};gAX.prototype.N=function(A,L){var B=A.action.actionMetadata.priority-L.action.actionMetadata.priority;B===0&&(A.N<L.N?B=-1:A.N>L.N&&(B=1));return B};g.G(XG,g.Y);XG.prototype.l1=function(){this.yj&&this.yj();g.Y.prototype.l1.call(this)};
XG.prototype.createAction=function(A,L){var B=g.Pv(A.entityKey).entityType,f=g.y0(16);return new Ii(B,f,A,L.actionId,L.rootActionId)};
XG.prototype.qp=function(A){var L=this,B,f,K,V,J,R,Z,N,F;return g.c(function(D){if(D.N==1){if(L.TL())return D.return();f=(B=A.offlineOrchestrationActionWrapperEntity)!=null?B:new Set;K=[];V=g.m(f);for(J=V.next();!J.done;J=V.next())R=J.value,Z=g.Pv(R),N=Z.entityId,s$W(L.N,N)||K.push(R);return g.X(D,i85(L,K),2)}F=D.W;return g.X(D,CX9(L,F),0)})};
XG.prototype.retry=function(){var A=this;return g.c(function(L){return g.X(L,$Bf(A),0)})};O8w.prototype.bW=function(A,L){L=L===void 0?!0:L;var B=this,f,K,V,J,R,Z,N,F;return g.c(function(D){switch(D.N){case 1:if(!B.N)return D.return();f=[];K=g.qQ(B.N.N,L);V=[];for(J={B2:0};J.B2<K.length;J={B2:J.B2},J.B2++)R=K[J.B2],Z=B.N.FC(R,"json3"),N=g.il(Z,{withCredentials:!0,format:"RAW"},3,500).then(function(I){return function(d){d={metadata:g.kc(K[I.B2]),trackData:d.xhr.responseText};V.push(d)}}(J)).c9(function(I){LB("Caption fetch error",I)}),f.push(N);
return g.X(D,e4d(f),2);case 2:return g.S5(D,3),g.X(D,hNf(A,V),5);case 5:g.ZR(D,0);break;case 3:F=g.NX(D),LB("Caption DB transaction error",F),g.VK(D)}})};g.G(O8,g.Y);O8.prototype.l1=function(){this.W&&this.W();g.Y.prototype.l1.call(this)};
O8.prototype.V=function(A){var L=this,B,f,K,V,J,R,Z,N;return g.c(function(F){f=(B=A.transfer)!=null?B:new Set;K=[];V=g.m(f);for(J=V.next();!J.done;J=V.next())R=J.value,Z=g.Pv(R),N=Z.entityId,K.push(N);return K.length===0?F.return():g.X(F,Mad(L,K),0)})};g.G(qEB,g.Y);g.p=qEB.prototype;g.p.l1=function(){this.Vj&&this.Vj();this.ZM.dispose();this.U.dispose();this.S4&&g.R$(this.T.CX,this.S4);this.JF&&g.R$(this.T.CX,this.JF);g.Y.prototype.l1.call(this)};
g.p.mFT=function(A){var L=this,B,f,K;return g.c(function(V){switch(V.N){case 1:B=g.xv(A,"transfer");if(L.N&&B===L.N.key){$J(L.X,L.D,!0);L.U.stop();V.Ux(0);break}return g.X(V,Px(L.W,{mode:"readwrite",Ev:!0},function(J){return cx(J,B,"transfer").then(function(R){if(R&&R.transferState!=="TRANSFER_STATE_COMPLETE"&&R.transferState!=="TRANSFER_STATE_FAILED")return R.transferState="TRANSFER_STATE_PAUSED_BY_USER",Uo(J,R,"transfer").then(function(){return R})})}),3);
case 3:f=V.W;if(!f){V.Ux(0);break}if(!A||!L.V){V.Ux(5);break}return g.X(V,N6(A,L.V,L.W,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.X(V,M6(L,A),7);case 7:K=V.W,A9t({videoId:A,RU:f,offlineModeType:K}),g.VK(V)}})};
g.p.Vo4=function(){var A=this;if(this.N&&this.D){$J(this.X,this.D,!1);var L=this.N,B=(L==null?0:L.key)?g.Pv(L.key).entityId:"";B&&this.V&&(new Promise(function(f,K){N6(B,A.V,A.W,"DOWNLOAD_STATE_PAUSED").catch(function(V){K(V)})})).catch(function(f){LB("Download state setting error",f)})}this.U.stop()};
g.p.AG=function(){this.N?eqR(this,this.N):cn(this)};
g.p.Bi=function(A){var L=this;return g.c(function(B){switch(B.N){case 1:if(!L.N){B.Ux(2);break}if(L.N.transferState==="TRANSFER_STATE_COMPLETE"||L.N.transferState==="TRANSFER_STATE_FAILED"||!A.transfer||!A.transfer.has(L.N.key)){B.Ux(3);break}return g.X(B,eJ(L.W,L.N.key,"transfer"),4);case 4:L.N=B.W;if(L.N){B.Ux(3);break}return g.X(B,nAB(L),3);case 3:if(L.N)return B.return();case 2:return g.X(B,cn(L),0)}})};
g.p.ZA=function(A,L){var B=this,f,K,V,J,R;return g.c(function(Z){switch(Z.N){case 1:if(!B.N){YJ(B,"onTransferFailure: "+A);Z.Ux(2);break}f=B.N;V=((K=f)==null?0:K.key)?g.Pv(f.key).entityId:"";a:switch(A){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var N=!1;break a;default:N=!0}return N&&K7X(B)?g.X(Z,U8(B,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.X(Z,
VAt(B,A),5);case 5:if(!V||!B.V){Z.Ux(2);break}return g.X(Z,N6(V,B.V,B.W,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.X(Z,M6(B,V),9);case 9:J=Z.W;VZ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:V,RU:f,offlineModeType:J});if(!V||!B.V){Z.Ux(2);break}return g.X(Z,N6(V,B.V,B.W,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:E8(B),R=cn(B,!0),L&&L(R),g.VK(Z)}})};
g.p.UM=function(A){var L=this,B,f,K,V,J,R,Z,N,F,D,I,d;return g.c(function(w){switch(w.N){case 1:if(!L.N){YJ(L,"onMaybeTransferStreamsExpired");w.Ux(2);break}return K7X(L)?g.X(w,U8(L,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.X(w,VAt(L,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!L.V){w.Ux(2);break}B=L.N;K=((f=B)==null?0:f.key)?g.Pv(B.key).entityId:"";if(!K){w.Ux(2);break}return g.X(w,N6(K,L.V,L.W,"DOWNLOAD_STATE_FAILED"),2);case 9:return L.N||YJ(L,"onMaybeTransferStreamsExpiredRetryAttempting"),
V=L.N,R=((J=V)==null?0:J.key)?g.Pv(V.key).entityId:"",g.X(w,M6(L,R),10);case 10:return Z=w.W,VZ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:R,RU:V,offlineModeType:Z}),N=VWB(),g.cb(N,QZ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),F=g.xv(R,"playbackData"),D={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:F,actionMetadata:N},I=pB(new Ii("playbackData",R,D)),g.X(w,xB(L.W,I,"offlineOrchestrationActionWrapperEntity"),2);case 2:E8(L),d=cn(L,!0),
A&&A(d),g.VK(w)}})};
var Zed={},JuB=(Zed.TRANSFER_STATE_TRANSFERRING=1,Zed.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,Zed);g.p=Wn.prototype;g.p.vM=function(){return this.D.promise};
g.p.i$=function(){if(this.W&&this.X)return this.D.promise;Z2d(this).then(this.D.resolve).catch(this.D.reject);return this.D.promise};
g.p.BN=function(A){var L={};return L.playbackData=new qa5(A,this.L,this.N),L.transfer=new Z8R(A,this.L),L.videoPlaybackPositionEntity=new aaB(A,this.L),L};
g.p.pN=function(){var A=this;return g.c(function(L){return A.W?g.X(L,PXd(A.W),0):L.Ux(0)})};
g.p.nM=function(){var A=this,L,B;return g.c(function(f){if(f.N==1)return A.W||A.X?g.X(f,A.vM(),2):f.return();A.G!==void 0&&(g.sQ(A.G),A.G=void 0);A.U!==void 0&&(g.sQ(A.U),A.U=void 0);(L=A.W)==null||L.dispose();A.W=void 0;(B=A.X)==null||B.dispose();A.X=void 0;A.api.Kr("onOrchestrationLostLeader");A.D=new g.IQ;g.VK(f)})};
g.p.isOrchestrationLeader=function(){return this.V.N};
g.p.xB=function(){return g.c(function(A){return A.return(!1)})};
g.p.Bw=function(A){var L=this.N;L.api.publish("offlinetransferpause",A);var B;(B=L.W)==null||B.postMessage(A)};
g.p.AG=function(A){var L,B;return g.c(function(f){if(f.N==1)return g.X(f,zq(),2);L=f.W;if(!L)return f.return();B=g.xv(A,"transfer");return g.X(f,Px(L,{mode:"readwrite",Ev:!0},function(K){var V=cx(K,B,"transfer"),J=cx(K,g.xv(A,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.r2.all([V,J]).then(function(R){R=g.m(R);var Z=R.next().value;var N=R.next().value;return Z&&Z.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(Z.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Uo(K,Z,"transfer").then(function(){VZ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:A,RU:Z,offlineModeType:N==null?void 0:N.offlineModeType});return g.r2.resolve(null)})):g.r2.resolve(null)})}),0)})};
g.p.TN=function(A){A=A===void 0?43200:A;var L=this,B,f,K,V,J,R,Z,N;return g.c(function(F){if(F.N==1)return L.T.Dr()?g.X(F,zq(),2):F.return(NsK());if(F.N!=3){B=F.W;if(!B)return F.return([]);f=Date.now()/1E3;return g.X(F,n7(B,"offlineVideoPolicy"),3)}K=F.W;V=[];J=g.m(K);for(R=J.next();!R.done;R=J.next())Z=R.value,Number(Z.lastUpdatedTimestampSeconds)+A<=f&&(N=g.Pv(Z.key).entityId,V.push(N));return V.length?F.return(vn(L,V,L.yj,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):F.return([])})};
g.p.deleteAll=function(){return vn(this,["!*$_ALL_ENTITIES_!*$"],this.yj,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.p.refreshAllStaleEntities=function(A){var L=this;return g.c(function(B){return B.N==1?g.X(B,L.TN(A),2):B.return(B.W)})};
g.p.setUpPositionSyncInterval=function(A){var L=this;this.U!==void 0&&(g.sQ(this.U),this.U=void 0);var B=A!=null?A:864E5;this.U=g.Gc(function(){L.Pm(B)},B)};
g.p.Pm=function(A){var L=this,B,f,K,V,J,R;return g.c(function(Z){switch(Z.N){case 1:return g.S5(Z,2),g.X(Z,XD.getInstance(),4);case 4:B=Z.W;if(!B)throw Error("prefStorage is undefined");return g.X(Z,B.get("psi"),5);case 5:f=Z.W;V=((K=f)==null?0:K.Mw)?Number(f.Mw)/1E3:0;J=Date.now();if(!(V+A<=J)){Z.Ux(6);break}return g.X(Z,vn(L,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.ZR(Z,0);break;case 2:R=g.NX(Z),LB("Offline manager error",R),
g.VK(Z)}})};
g.p.CN=function(){var A=this,L,B,f,K,V,J,R;return g.c(function(Z){if(Z.N==1)return g.X(Z,zq(),2);if(Z.N!=3)return(L=Z.W)?g.X(Z,n7(L,"transfer"),3):Z.return([]);B=Z.W;f=[];K=g.m(B);for(V=K.next();!V.done;V=K.next())J=V.value,J.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&J.key&&(R=g.Pv(J.key).entityId,f.push(R));return Z.return(DWK(A,f))})};
g.p.Dw=function(){return g.c(function(A){return A.return([])})};
g.p.ZS=function(){return g.c(function(A){g.VK(A)})};
g.p.Sp=function(){return g.c(function(A){g.VK(A)})};g.G(dWw,Tf);dWw.prototype.W=function(A){return SI(A)?pcI(this,A):Ri(A)?jQK(this,A):Ze(A)?gMB(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var q6=[10];g.G(hvI,Tf);hvI.prototype.W=function(A){return SI(A)?kXw(this,A):Ri(A)?Tsf(this,A):Ze(A)?lH9(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var tAO=[10];g.G(QQf,Tf);QQf.prototype.W=function(A){return Ri(A)?i29(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};g.G($WR,Wn);g.p=$WR.prototype;g.p.BN=function(A){var L=Wn.prototype.BN.call(this,A);L.mainVideoEntity=new hvI(A,this.L,this.N);L.mainPlaylistEntity=new dWw(A,this.L,this.N);L.mainDownloadsListEntity=new QQf(A,this.L,this.N);return L};
g.p.refreshAllStaleEntities=function(A,L){var B=this,f,K,V,J,R,Z,N,F,D,I,d;return g.c(function(w){switch(w.N){case 1:f=[];if(!B.L.J("web_player_offline_playlist_auto_refresh")){w.Ux(2);break}return g.X(w,Xcw(B,A,L),3);case 3:f=w.W;case 2:return g.X(w,XD.getInstance(),4);case 4:return K=w.W,g.X(w,(V=K)==null?void 0:V.get("sdois"),5);case 5:return J=w.W,g.X(w,(R=K)==null?void 0:R.get("lmqf"),6);case 6:Z=w.W;if(!J){w.Ux(7);break}F=f;D=F.concat;return g.X(w,O2f(B,J,(N=Z)!=null?N:"SD",A===0),8);case 8:f=
D.call(F,w.W);case 7:return I=f,d=I.concat,g.X(w,Wn.prototype.refreshAllStaleEntities.call(B,A,L),9);case 9:return f=d.call(I,w.W),w.return(f)}})};
g.p.xB=function(A){var L,B,f,K,V,J,R,Z;return g.c(function(N){if(N.N==1)return g.X(N,zq(),2);if(N.N!=3)return(L=N.W)?g.X(N,eJ(L,g.CI,"mainDownloadsListEntity"),3):N.return(!1);B=N.W;if((f=B)==null?0:(K=f.downloads)==null?0:K.length)for(V=g.xv(A,"mainVideoEntity"),J=g.m(B.downloads),R=J.next();!R.done;R=J.next())if(Z=R.value,Z.videoItem===V)return N.return(!0);return N.return(!1)})};
g.p.Dw=function(){var A=this,L,B,f,K,V,J,R,Z;return g.c(function(N){if(N.N==1)return g.X(N,zq(),2);if(N.N!=3)return(L=N.W)?g.X(N,n7(L,"downloadStatusEntity"),3):N.return([]);B=N.W;f=[];K=g.m(B);for(V=K.next();!V.done;V=K.next())J=V.value,J.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&J.key&&(R=g.Pv(J.key).entityId,f.push(R));return f.length?(Z={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},N.return(vn(A,f,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Z))):N.return([])})};
g.p.Sp=function(){var A;return g.c(function(L){return L.N==1?g.X(L,zq(),2):(A=L.W)?g.X(L,Px(A,{mode:"readwrite",Ev:!0},function(B){return Mk(B,"mainVideoEntity").then(function(f){var K=[];f=g.m(f);for(var V=f.next();!V.done;V=f.next()){V=V.value;var J=void 0;(J=V.userState)!=null&&J.playbackPosition||(J=g.Pv(V.key).entityId,J={key:g.xv(J,"videoPlaybackPositionEntity"),videoId:J,lastPlaybackPositionSeconds:"0"},K.push(Uo(B,J,"videoPlaybackPositionEntity")),V.userState={playbackPosition:J.key},K.push(Uo(B,
V,"mainVideoEntity")))}return g.r2.all(K)})}),0):L.return()})};
g.p.ZS=function(){var A,L,B,f,K,V,J,R,Z,N,F,D,I,d,w,r,h,Q,l,C,O,v,U,a,o0,B6,Ve,DS,fw,ry,uL,Jf,MC,nw,Xk,e5,mt,T;return g.c(function(aO){if(aO.N==1)return g.X(aO,zq(),2);if(aO.N!=3){A=aO.W;if(!A)return aO.return();L=g.xv("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.X(aO,Px(A,{mode:"readonly",Ev:!0},function(YW){return g.r2.all([cx(YW,L,"mainDownloadsListEntity"),cx(YW,g.CI,"mainDownloadsListEntity"),Mk(YW,"mainVideoEntity"),Mk(YW,"mainPlaylistEntity")])}),3)}B=aO.W;
f=g.m(B);K=f.next().value;V=f.next().value;J=f.next().value;R=f.next().value;Z=K;N=V;F=J;D=R;I=new Set;if((d=Z)==null?0:(w=d.downloads)==null?0:w.length)for(r=g.m(Z.downloads),h=r.next();!h.done;h=r.next())Q=h.value,l=void 0,(C=(l=Q.videoItem)!=null?l:Q.playlistItem)&&I.add(C);if((O=N)==null?0:(v=O.downloads)==null?0:v.length)for(U=g.m(N.downloads),a=U.next();!a.done;a=U.next())o0=a.value,o0.videoItem&&I.add(o0.videoItem);B6=new Set;Ve=[];DS=g.m(D);for(fw=DS.next();!fw.done;fw=DS.next()){ry=fw.value;
if(ry.videos)for(uL=g.m(ry.videos),Jf=uL.next();!Jf.done;Jf=uL.next())MC=Jf.value,(nw=JSON.parse(g.Pv(MC).entityId).videoId)&&B6.add(nw);ry.key&&!I.has(ry.key)&&Ve.push(ry.key)}Xk=g.m(F);for(e5=Xk.next();!e5.done;e5=Xk.next())mt=e5.value,mt.key&&!I.has(mt.key)&&(T=g.Pv(mt.key).entityId,B6.has(T)||Ve.push(mt.key));return Ve.length?g.X(aO,jxt(A,Ve),0):aO.Ux(0)})};g.G(EMw,Tf);EMw.prototype.W=function(A){return SI(A)?MAw(this,A):Ri(A)?Ykt(this,A):Ze(A)?UW9(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var xJ=[10];g.G(vMt,Tf);vMt.prototype.W=function(A){return SI(A)?P0f(this,A):Ri(A)?xWX(this,A):Ze(A)?evf(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var eI=[10];g.G(umf,Tf);umf.prototype.W=function(A){return SI(A)?owK(this,A):Ri(A)?BlR(this,A):Ze(A)?ftw(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var LK5=[10];g.G(nB,Wn);nB.prototype.BN=function(A){var L=Wn.prototype.BN.call(this,A);L.musicTrack=new umf(A,this.N);L.musicPlaylist=new vMt(A,this.N);L.musicAlbumRelease=new EMw(A,this.N);return L};
nB.prototype.refreshAllStaleEntities=function(A,L){var B=this,f,K,V;return g.c(function(J){if(J.N==1)return g.X(J,VFt(B,A,L),2);if(J.N!=3)return K=f=J.W,V=K.concat,g.X(J,Wn.prototype.refreshAllStaleEntities.call(B,A,L),3);f=V.call(K,J.W);return J.return(f)})};g.G(JXt,g.FB);g.p=JXt.prototype;g.p.create=function(){var A=this;g.W(this,this.events);if(g.SK(this.L))this.N=new $WR(this.L,this.player);else if(g.cH(this.L)||g.Z_(this.L))this.N=new nB(this.L,this.player);this.events.Y(this.player,"onPlaybackStartExternal",function(){A.D9()});
this.events.Y(this.player,"videodatachange",function(){A.D9()});
this.L.J("html5_offline_playback_position_sync")&&this.events.Y(this.player,"presentingplayerstatechange",this.DK)};
g.p.Pg=function(){return!1};
g.p.cW=function(A,L,B,f){var K=this;return g.c(function(V){return K.N?V.return(vn(K.N,A,L,B,f)):V.return(Promise.reject())})};
g.p.deleteAll=function(){return this.N.deleteAll()};
g.p.TN=function(A){return this.N.TN(A)};
g.p.refreshAllStaleEntities=function(A){return this.N.refreshAllStaleEntities(A)};
g.p.setUpPositionSyncInterval=function(A){this.N.setUpPositionSyncInterval(A)};
g.p.Bw=function(A){this.N.Bw(A)};
g.p.AG=function(A){return this.N.AG(A)};
g.p.D9=function(){var A=this,L;return g.c(function(B){L=A.player.getVideoData();return g.Jj(L)?SBW(L)&&A.W!==L.clientPlaybackNonce?g.X(B,RMK(A,L),0):B.Ux(0):B.return()})};
g.p.DK=function(A){var L=this,B,f,K,V,J,R,Z;return g.c(function(N){if(N.N==1)return B=L.player.getVideoData(),f=B.jI,g.wk(A,2)||g.wk(A,512)?g.X(N,zq(),2):N.return();if(N.N!=3){K=N.W;if(!K)return LB("PES is undefined"),N.return();V=B.videoId;return g.X(N,eJ(K,g.xv(V,"mainVideoEntity"),"mainVideoEntity"),3)}J=N.W;if(!J)return N.return();R=Math.floor(f).toString();Z={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:R}};return g.X(N,L.cW([V],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
Z),0)})};
g.p.isOrchestrationLeader=function(){return this.N.isOrchestrationLeader()};
g.p.updateDownloadState=function(A,L){var B,f,K,V;return g.c(function(J){if(J.N==1)return g.X(J,zq(),2);B=J.W;if(!B)return LB("PES is undefined"),J.return();f=g.Pv(A);K=f.entityType;V=f.entityId;return g.X(J,N6(V,K,B,L,!0),0)})};g.Np("offline",JXt);})(_yt_player);
